function ProtobufMessage(){this.init()}!function(e,t,i){function s(e,t){return typeof e===t}function r(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):u?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}var n=[],o=[],a={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var i=this;setTimeout(function(){t(i[e])},0)},addTest:function(e,t,i){o.push({name:e,fn:t,options:i})},addAsyncTest:function(e){o.push({name:null,fn:e})}},h=function(){};h.prototype=a,h=new h;var l=a._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];a._prefixes=l;var f=t.documentElement,u="svg"===f.nodeName.toLowerCase(),c="Moz O ms Webkit",d=a._config.usePrefixes?c.toLowerCase().split(" "):[];a._domPrefixes=d;var g=function(e,t){var i=!1,s=r("div"),n=s.style;if(e in n){var o=d.length;for(n[e]=t,i=n[e];o--&&!i;)n[e]="-"+d[o]+"-"+t,i=n[e]}return""===i&&(i=!1),i};a.prefixedCSSValue=g,function(){var e,t,i,r,a,l,f;for(var u in o)if(o.hasOwnProperty(u)){if(e=[],t=o[u],t.name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(i=0;i<t.options.aliases.length;i++)e.push(t.options.aliases[i].toLowerCase());for(r=s(t.fn,"function")?t.fn():t.fn,a=0;a<e.length;a++)l=e[a],f=l.split("."),1===f.length?h[f[0]]=r:(!h[f[0]]||h[f[0]]instanceof Boolean||(h[f[0]]=new Boolean(h[f[0]])),h[f[0]][f[1]]=r),n.push((r?"":"no-")+f.join("-"))}}(),function(e){var t=f.className,i=h._config.classPrefix||"";if(u&&(t=t.baseVal),h._config.enableJSClass){var s=new RegExp("(^|\\s)"+i+"no-js(\\s|$)");t=t.replace(s,"$1"+i+"js$2")}h._config.enableClasses&&(t+=" "+i+e.join(" "+i),u?f.className.baseVal=t:f.className=t)}(n),delete a.addTest,delete a.addAsyncTest;for(var p=0;p<h._q.length;p++)h._q[p]();e.Modernizr=h}(window,document),function(e,t){"function"==typeof define&&define.amd?define([],function(){(e.dcodeIO=e.dcodeIO||{}).Long=t()}):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(this,function(){"use strict";function e(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function t(e){return(e&&e.__isLong__)===!0}function i(e,t){var i,s,n;return t?(e>>>=0,(n=0<=e&&e<256)&&(s=h[e])?s:(i=r(e,(0|e)<0?-1:0,!0),n&&(h[e]=i),i)):(e|=0,(n=-128<=e&&e<128)&&(s=a[e])?s:(i=r(e,e<0?-1:0,!1),n&&(a[e]=i),i))}function s(e,t){if(isNaN(e)||!isFinite(e))return t?p:g;if(t){if(e<0)return p;if(e>=u)return w}else{if(e<=-c)return E;if(e+1>=c)return b}return e<0?s(-e,t).neg():r(e%f|0,e/f|0,t)}function r(t,i,s){return new e(t,i,s)}function n(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"==typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return n(e.substring(1),t,i).neg();for(var o=s(l(i,8)),a=g,h=0;h<e.length;h+=8){var f=Math.min(8,e.length-h),u=parseInt(e.substring(h,h+f),i);if(f<8){var c=s(l(i,f));a=a.mul(c).add(s(u))}else a=a.mul(o),a=a.add(s(u))}return a.unsigned=t,a}function o(t){return t instanceof e?t:"number"==typeof t?s(t):"string"==typeof t?n(t):r(t.low,t.high,t.unsigned)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var a={},h={};e.fromInt=i,e.fromNumber=s,e.fromBits=r;var l=Math.pow;e.fromString=n,e.fromValue=o;var f=4294967296,u=f*f,c=u/2,d=i(1<<24),g=i(0);e.ZERO=g;var p=i(0,!0);e.UZERO=p;var m=i(1);e.ONE=m;var y=i(1,!0);e.UONE=y;var v=i(-1);e.NEG_ONE=v;var b=r(-1,2147483647,!1);e.MAX_VALUE=b;var w=r(-1,-1,!0);e.MAX_UNSIGNED_VALUE=w;var E=r(0,-2147483648,!1);e.MIN_VALUE=E;var T=e.prototype;return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(E)){var t=s(e),i=this.div(t),r=i.mul(t).sub(this);return i.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=s(l(e,6),this.unsigned),o=this,a="";;){var h=o.div(n),f=o.sub(h.mul(n)).toInt()>>>0,u=f.toString(e);if(o=h,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return t(e)||(e=o(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.compare=function(e){if(t(e)||(e=o(e)),this.eq(e))return 0;var i=this.isNegative(),s=e.isNegative();return i&&!s?-1:!i&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(m)},T.neg=T.negate,T.add=function(e){t(e)||(e=o(e));var i=this.high>>>16,s=65535&this.high,n=this.low>>>16,a=65535&this.low,h=e.high>>>16,l=65535&e.high,f=e.low>>>16,u=65535&e.low,c=0,d=0,g=0,p=0;return p+=a+u,g+=p>>>16,p&=65535,g+=n+f,d+=g>>>16,g&=65535,d+=s+l,c+=d>>>16,d&=65535,c+=i+h,c&=65535,r(g<<16|p,c<<16|d,this.unsigned)},T.subtract=function(e){return t(e)||(e=o(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){if(this.isZero())return g;if(t(e)||(e=o(e)),e.isZero())return g;if(this.eq(E))return e.isOdd()?E:g;if(e.eq(E))return this.isOdd()?E:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(d)&&e.lt(d))return s(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,n=65535&this.high,a=this.low>>>16,h=65535&this.low,l=e.high>>>16,f=65535&e.high,u=e.low>>>16,c=65535&e.low,p=0,m=0,y=0,v=0;return v+=h*c,y+=v>>>16,v&=65535,y+=a*c,m+=y>>>16,y&=65535,y+=h*u,m+=y>>>16,y&=65535,m+=n*c,p+=m>>>16,m&=65535,m+=a*u,p+=m>>>16,m&=65535,m+=h*f,p+=m>>>16,m&=65535,p+=i*c+n*u+a*f+h*l,p&=65535,r(y<<16|v,p<<16|m,this.unsigned)},T.mul=T.multiply,T.divide=function(e){if(t(e)||(e=o(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?p:g;var i,r,n;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return p;if(e.gt(this.shru(1)))return y;n=p}else{if(this.eq(E)){if(e.eq(m)||e.eq(v))return E;if(e.eq(E))return m;return i=this.shr(1).div(e).shl(1),i.eq(g)?e.isNegative()?m:v:(r=this.sub(e.mul(i)),n=i.add(r.div(e)))}if(e.eq(E))return this.unsigned?p:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=g}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(i)/Math.LN2),h=a<=48?1:l(2,a-48),f=s(i),u=f.mul(e);u.isNegative()||u.gt(r);)i-=h,f=s(i,this.unsigned),u=f.mul(e);f.isZero()&&(f=m),n=n.add(f),r=r.sub(u)}return n},T.div=T.divide,T.modulo=function(e){return t(e)||(e=o(e)),this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.not=function(){return r(~this.low,~this.high,this.unsigned)},T.and=function(e){return t(e)||(e=o(e)),r(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return t(e)||(e=o(e)),r(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return t(e)||(e=o(e)),r(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?r(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):r(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?r(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):r(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0===(e&=63))return this;var i=this.high;if(e<32){return r(this.low>>>e|i<<32-e,i>>>e,this.unsigned)}return 32===e?r(i,0,this.unsigned):r(i>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?r(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:r(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e}),function(e,t){"function"==typeof define&&define.amd?define(["/v2/web/boss/js/module/chat-long.js"],function(){(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=t(e.dcodeIO.Long)}):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=function(){var e;try{e=require("long")}catch(e){}return t(e)}():(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=t(e.dcodeIO.Long)}(this,function(e){"use strict";function t(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function i(){var e=[],t=[];return function(){if(0===arguments.length)return t.join("")+h.apply(String,e);e.length+arguments.length>1024&&(t.push(h.apply(String,e)),e.length=0),Array.prototype.push.apply(e,arguments)}}function s(e,t,i,s,r){var n,o,a=8*r-s-1,h=(1<<a)-1,l=h>>1,f=-7,u=i?r-1:0,c=i?-1:1,d=e[t+u];for(u+=c,n=d&(1<<-f)-1,d>>=-f,f+=a;f>0;n=256*n+e[t+u],u+=c,f-=8);for(o=n&(1<<-f)-1,n>>=-f,f+=s;f>0;o=256*o+e[t+u],u+=c,f-=8);if(0===n)n=1-l;else{if(n===h)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,s),n-=l}return(d?-1:1)*o*Math.pow(2,n-s)}function r(e,t,i,s,r,n){var o,a,h,l=8*n-r-1,f=(1<<l)-1,u=f>>1,c=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=s?0:n-1,g=s?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=f):(o=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-o))<1&&(o--,h*=2),t+=o+u>=1?c/h:c*Math.pow(2,1-u),t*h>=2&&(o++,h/=2),o+u>=f?(a=0,o=f):o+u>=1?(a=(t*h-1)*Math.pow(2,r),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;e[i+d]=255&a,d+=g,a/=256,r-=8);for(o=o<<r|a,l+=r;l>0;e[i+d]=255&o,d+=g,o/=256,l-=8);e[i+d-g]|=128*p}var n=function(e,t,i){if(void 0===e&&(e=n.DEFAULT_CAPACITY),void 0===t&&(t=n.DEFAULT_ENDIAN),void 0===i&&(i=n.DEFAULT_NOASSERT),!i){if((e|=0)<0)throw RangeError("Illegal capacity");t=!!t,i=!!i}this.buffer=0===e?a:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=i};n.VERSION="5.0.1",n.LITTLE_ENDIAN=!0,n.BIG_ENDIAN=!1,n.DEFAULT_CAPACITY=16,n.DEFAULT_ENDIAN=n.BIG_ENDIAN,n.DEFAULT_NOASSERT=!1,n.Long=e||null;var o=n.prototype;o.__isByteBuffer__,Object.defineProperty(o,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var a=new ArrayBuffer(0),h=String.fromCharCode;n.accessor=function(){return Uint8Array},n.allocate=function(e,t,i){return new n(e,t,i)},n.concat=function(e,t,i,s){"boolean"!=typeof t&&"string"==typeof t||(s=i,i=t,t=void 0);for(var r,o=0,a=0,h=e.length;a<h;++a)n.isByteBuffer(e[a])||(e[a]=n.wrap(e[a],t)),(r=e[a].limit-e[a].offset)>0&&(o+=r);if(0===o)return new n(0,i,s);var l,f=new n(o,i,s);for(a=0;a<h;)l=e[a++],(r=l.limit-l.offset)<=0||(f.view.set(l.view.subarray(l.offset,l.limit),f.offset),f.offset+=r);return f.limit=f.offset,f.offset=0,f},n.isByteBuffer=function(e){return(e&&e.__isByteBuffer__)===!0},n.type=function(){return ArrayBuffer},n.wrap=function(e,t,i,s){if("string"!=typeof t&&(s=i,i=t,t=void 0),"string"==typeof e)switch(void 0===t&&(t="utf8"),t){case"base64":return n.fromBase64(e,i);case"hex":return n.fromHex(e,i);case"binary":return n.fromBinary(e,i);case"utf8":return n.fromUTF8(e,i);case"debug":return n.fromDebug(e,i);default:throw Error("Unsupported encoding: "+t)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");var r;if(n.isByteBuffer(e))return r=o.clone.call(e),r.markedOffset=-1,r;if(e instanceof Uint8Array)r=new n(0,i,s),e.length>0&&(r.buffer=e.buffer,r.offset=e.byteOffset,r.limit=e.byteOffset+e.byteLength,r.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)r=new n(0,i,s),e.byteLength>0&&(r.buffer=e,r.offset=0,r.limit=e.byteLength,r.view=e.byteLength>0?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");r=new n(e.length,i,s),r.limit=e.length;for(var a=0;a<e.length;++a)r.view[a]=e[a]}return r},o.writeBitSet=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var s,r=t,n=e.length,o=n>>3,a=0;for(t+=this.writeVarint32(n,t);o--;)s=1&!!e[a++]|(1&!!e[a++])<<1|(1&!!e[a++])<<2|(1&!!e[a++])<<3|(1&!!e[a++])<<4|(1&!!e[a++])<<5|(1&!!e[a++])<<6|(1&!!e[a++])<<7,this.writeByte(s,t++);if(a<n){var h=0;for(s=0;a<n;)s|=(1&!!e[a++])<<h++;this.writeByte(s,t++)}return i?(this.offset=t,this):t-r},o.readBitSet=function(e){var t=void 0===e;t&&(e=this.offset);var i,s=this.readVarint32(e),r=s.value,n=r>>3,o=0,a=[];for(e+=s.length;n--;)i=this.readByte(e++),a[o++]=!!(1&i),a[o++]=!!(2&i),a[o++]=!!(4&i),a[o++]=!!(8&i),a[o++]=!!(16&i),a[o++]=!!(32&i),a[o++]=!!(64&i),a[o++]=!!(128&i);if(o<r){var h=0;for(i=this.readByte(e++);o<r;)a[o++]=!!(i>>h++&1)}return t&&(this.offset=e),a},o.readBytes=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}var s=this.slice(t,t+e);return i&&(this.offset+=e),s},o.writeBytes=o.append,o.writeInt8=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},o.writeByte=o.writeInt8,o.readInt8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=this.view[e];return 128==(128&i)&&(i=-(255-i+1)),t&&(this.offset+=1),i},o.readByte=o.readInt8,o.writeUint8=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},o.writeUInt8=o.writeUint8,o.readUint8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=this.view[e];return t&&(this.offset+=1),i},o.readUInt8=o.readUint8,o.writeInt16=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},o.writeShort=o.writeInt16,o.readInt16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),32768==(32768&i)&&(i=-(65535-i+1)),t&&(this.offset+=2),i},o.readShort=o.readInt16,o.writeUint16=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},o.writeUInt16=o.writeUint16,o.readUint16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),t&&(this.offset+=2),i},o.readUInt16=o.readUint16,o.writeInt32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},o.writeInt=o.writeInt32,o.readInt32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),i|=0,t&&(this.offset+=4),i},o.readInt=o.readInt32,o.writeUint32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},o.writeUInt32=o.writeUint32,o.readUint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),t&&(this.offset+=4),i},o.readUInt32=o.readUint32,e&&(o.writeInt64=function(t,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),i+=8;var r=this.buffer.byteLength;i>r&&this.resize((r*=2)>i?r:i),i-=8;var n=t.low,o=t.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=o>>>24&255,this.view[i+2]=o>>>16&255,this.view[i+1]=o>>>8&255,this.view[i]=255&o):(this.view[i]=o>>>24&255,this.view[i+1]=o>>>16&255,this.view[i+2]=o>>>8&255,this.view[i+3]=255&o,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),s&&(this.offset+=8),this},o.writeLong=o.writeInt64,o.readInt64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var s=0,r=0;this.littleEndian?(s=this.view[t+2]<<16,s|=this.view[t+1]<<8,s|=this.view[t],s+=this.view[t+3]<<24>>>0,t+=4,r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0,t+=4,s=this.view[t+1]<<16,s|=this.view[t+2]<<8,s|=this.view[t+3],s+=this.view[t]<<24>>>0);var n=new e(s,r,!1);return i&&(this.offset+=8),n},o.readLong=o.readInt64,o.writeUint64=function(t,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),i+=8;var r=this.buffer.byteLength;i>r&&this.resize((r*=2)>i?r:i),i-=8;var n=t.low,o=t.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=o>>>24&255,this.view[i+2]=o>>>16&255,this.view[i+1]=o>>>8&255,this.view[i]=255&o):(this.view[i]=o>>>24&255,this.view[i+1]=o>>>16&255,this.view[i+2]=o>>>8&255,this.view[i+3]=255&o,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),s&&(this.offset+=8),this},o.writeUInt64=o.writeUint64,o.readUint64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var s=0,r=0;this.littleEndian?(s=this.view[t+2]<<16,s|=this.view[t+1]<<8,s|=this.view[t],s+=this.view[t+3]<<24>>>0,t+=4,r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0,t+=4,s=this.view[t+1]<<16,s|=this.view[t+2]<<8,s|=this.view[t+3],s+=this.view[t]<<24>>>0);var n=new e(s,r,!0);return i&&(this.offset+=8),n},o.readUInt64=o.readUint64),o.writeFloat32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=4,r(this.view,e,t,this.littleEndian,23,4),i&&(this.offset+=4),this},o.writeFloat=o.writeFloat32,o.readFloat32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=s(this.view,e,this.littleEndian,23,4);return t&&(this.offset+=4),i},o.readFloat=o.readFloat32,o.writeFloat64=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=8,r(this.view,e,t,this.littleEndian,52,8),i&&(this.offset+=8),this},o.writeDouble=o.writeFloat64,o.readFloat64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=s(this.view,e,this.littleEndian,52,8);return t&&(this.offset+=8),i},o.readDouble=o.readFloat64,n.MAX_VARINT32_BYTES=5,n.calculateVarint32=function(e){return e>>>=0,e<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5},n.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},n.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},o.writeVarint32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var s,r=n.calculateVarint32(e);t+=r;var o=this.buffer.byteLength;for(t>o&&this.resize((o*=2)>t?o:t),t-=r,e>>>=0;e>=128;)s=127&e|128,this.view[t++]=s,e>>>=7;return this.view[t++]=e,i?(this.offset=t,this):r},o.writeVarint32ZigZag=function(e,t){return this.writeVarint32(n.zigZagEncode32(e),t)},o.readVarint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i,s=0,r=0;do{if(!this.noAssert&&e>this.limit){var n=Error("Truncated");throw n.truncated=!0,n}i=this.view[e++],s<5&&(r|=(127&i)<<7*s),++s}while(0!=(128&i));return r|=0,t?(this.offset=e,r):{value:r,length:s}},o.readVarint32ZigZag=function(e){var t=this.readVarint32(e);return"object"==typeof t?t.value=n.zigZagDecode32(t.value):t=n.zigZagDecode32(t),t},e&&(n.MAX_VARINT64_BYTES=10,n.calculateVarint64=function(t){"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t));var i=t.toInt()>>>0,s=t.shiftRightUnsigned(28).toInt()>>>0,r=t.shiftRightUnsigned(56).toInt()>>>0;return 0==r?0==s?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:r<128?9:10},n.zigZagEncode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):t.unsigned!==!1&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},n.zigZagDecode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):t.unsigned!==!1&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},o.writeVarint64=function(t,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):t.unsigned!==!1&&(t=t.toSigned());var r=n.calculateVarint64(t),o=t.toInt()>>>0,a=t.shiftRightUnsigned(28).toInt()>>>0,h=t.shiftRightUnsigned(56).toInt()>>>0;i+=r;var l=this.buffer.byteLength;switch(i>l&&this.resize((l*=2)>i?l:i),i-=r,r){case 10:this.view[i+9]=h>>>7&1;case 9:this.view[i+8]=9!==r?128|h:127&h;case 8:this.view[i+7]=8!==r?a>>>21|128:a>>>21&127;case 7:this.view[i+6]=7!==r?a>>>14|128:a>>>14&127;case 6:this.view[i+5]=6!==r?a>>>7|128:a>>>7&127;case 5:this.view[i+4]=5!==r?128|a:127&a;case 4:this.view[i+3]=4!==r?o>>>21|128:o>>>21&127;case 3:this.view[i+2]=3!==r?o>>>14|128:o>>>14&127;case 2:this.view[i+1]=2!==r?o>>>7|128:o>>>7&127;case 1:this.view[i]=1!==r?128|o:127&o}return s?(this.offset+=r,this):r},o.writeVarint64ZigZag=function(e,t){return this.writeVarint64(n.zigZagEncode64(e),t)},o.readVarint64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var s=t,r=0,n=0,o=0,a=0;if(a=this.view[t++],r=127&a,128&a&&(a=this.view[t++],r|=(127&a)<<7,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],r|=(127&a)<<14,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],r|=(127&a)<<21,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],n=127&a,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],n|=(127&a)<<7,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],n|=(127&a)<<14,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],n|=(127&a)<<21,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],o=127&a,(128&a||this.noAssert&&void 0===a)&&(a=this.view[t++],o|=(127&a)<<7,128&a||this.noAssert&&void 0===a))))))))))throw Error("Buffer overrun");var h=e.fromBits(r|n<<28,n>>>4|o<<24,!1);return i?(this.offset=t,h):{value:h,length:t-s}},o.readVarint64ZigZag=function(t){var i=this.readVarint64(t);return i&&i.value instanceof e?i.value=n.zigZagDecode64(i.value):i=n.zigZagDecode64(i),i}),o.writeCString=function(e,i){var s=void 0===i;s&&(i=this.offset);var r,n=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string")
;for(r=0;r<n;++r)if(0===e.charCodeAt(r))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}n=f.calculateUTF16asUTF8(t(e))[1],i+=n+1;var o=this.buffer.byteLength;return i>o&&this.resize((o*=2)>i?o:i),i-=n+1,f.encodeUTF16toUTF8(t(e),function(e){this.view[i++]=e}.bind(this)),this.view[i++]=0,s?(this.offset=i,this):n},o.readCString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var s,r=e,n=-1;return f.decodeUTF8toUTF16(function(){if(0===n)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return n=this.view[e++],0===n?null:n}.bind(this),s=i(),!0),t?(this.offset=e,s()):{string:s(),length:e-r}},o.writeIString=function(e,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var r,n=i;r=f.calculateUTF16asUTF8(t(e),this.noAssert)[1],i+=4+r;var o=this.buffer.byteLength;if(i>o&&this.resize((o*=2)>i?o:i),i-=4+r,this.littleEndian?(this.view[i+3]=r>>>24&255,this.view[i+2]=r>>>16&255,this.view[i+1]=r>>>8&255,this.view[i]=255&r):(this.view[i]=r>>>24&255,this.view[i+1]=r>>>16&255,this.view[i+2]=r>>>8&255,this.view[i+3]=255&r),i+=4,f.encodeUTF16toUTF8(t(e),function(e){this.view[i++]=e}.bind(this)),i!==n+4+r)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+4+r));return s?(this.offset=i,this):i-n},o.readIString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=e,s=this.readUint32(e),r=this.readUTF8String(s,n.METRICS_BYTES,e+=4);return e+=r.length,t?(this.offset=e,r.string):{string:r.string,length:e-i}},n.METRICS_CHARS="c",n.METRICS_BYTES="b",o.writeUTF8String=function(e,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var r,n=i;r=f.calculateUTF16asUTF8(t(e))[1],i+=r;var o=this.buffer.byteLength;return i>o&&this.resize((o*=2)>i?o:i),i-=r,f.encodeUTF16toUTF8(t(e),function(e){this.view[i++]=e}.bind(this)),s?(this.offset=i,this):i-n},o.writeString=o.writeUTF8String,n.calculateUTF8Chars=function(e){return f.calculateUTF16asUTF8(t(e))[0]},n.calculateUTF8Bytes=function(e){return f.calculateUTF16asUTF8(t(e))[1]},n.calculateString=n.calculateUTF8Bytes,o.readUTF8String=function(e,t,s){"number"==typeof t&&(s=t,t=void 0);var r=void 0===s;if(r&&(s=this.offset),void 0===t&&(t=n.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof s||s%1!=0)throw TypeError("Illegal offset: "+s+" (not an integer)");if((s>>>=0)<0||s+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+s+" (+0) <= "+this.buffer.byteLength)}var o,a=0,h=s;if(t===n.METRICS_CHARS){if(o=i(),f.decodeUTF8(function(){return a<e&&s<this.limit?this.view[s++]:null}.bind(this),function(e){++a,f.UTF8toUTF16(e,o)}),a!==e)throw RangeError("Illegal range: Truncated data, "+a+" == "+e);return r?(this.offset=s,o()):{string:o(),length:s-h}}if(t===n.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof s||s%1!=0)throw TypeError("Illegal offset: "+s+" (not an integer)");if((s>>>=0)<0||s+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+s+" (+"+e+") <= "+this.buffer.byteLength)}var l=s+e;if(f.decodeUTF8toUTF16(function(){return s<l?this.view[s++]:null}.bind(this),o=i(),this.noAssert),s!==l)throw RangeError("Illegal range: Truncated data, "+s+" == "+l);return r?(this.offset=s,o()):{string:o(),length:s-h}}throw TypeError("Unsupported metrics: "+t)},o.readString=o.readUTF8String,o.writeVString=function(e,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var r,o,a=i;r=f.calculateUTF16asUTF8(t(e),this.noAssert)[1],o=n.calculateVarint32(r),i+=o+r;var h=this.buffer.byteLength;if(i>h&&this.resize((h*=2)>i?h:i),i-=o+r,i+=this.writeVarint32(r,i),f.encodeUTF16toUTF8(t(e),function(e){this.view[i++]=e}.bind(this)),i!==a+r+o)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+r+o));return s?(this.offset=i,this):i-a},o.readVString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=e,s=this.readVarint32(e),r=this.readUTF8String(s.value,n.METRICS_BYTES,e+=s.length);return e+=r.length,t?(this.offset=e,r.string):{string:r.string,length:e-i}},o.append=function(e,t,i){"number"!=typeof t&&"string"==typeof t||(i=t,t=void 0);var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}e instanceof n||(e=n.wrap(e,t));var r=e.limit-e.offset;if(r<=0)return this;i+=r;var o=this.buffer.byteLength;return i>o&&this.resize((o*=2)>i?o:i),i-=r,this.view.set(e.view.subarray(e.offset,e.limit),i),e.offset+=r,s&&(this.offset+=r),this},o.appendTo=function(e,t){return e.append(this,t),this},o.assert=function(e){return this.noAssert=!e,this},o.capacity=function(){return this.buffer.byteLength},o.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},o.clone=function(e){var t=new n(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},o.compact=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var i=t-e;if(0===i)return this.buffer=a,this.view=null,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var s=new ArrayBuffer(i),r=new Uint8Array(s);return r.set(this.view.subarray(e,t)),this.buffer=s,this.view=r,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=i,this},o.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return new n(0,this.littleEndian,this.noAssert);var i=t-e,s=new n(i,this.littleEndian,this.noAssert);return s.offset=0,s.limit=i,s.markedOffset>=0&&(s.markedOffset-=e),this.copyTo(s,0,e,t),s},o.copyTo=function(e,t,i,s){var r,o;if(!this.noAssert&&!n.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(t=(o=void 0===t)?e.offset:0|t,i=(r=void 0===i)?this.offset:0|i,s=void 0===s?this.limit:0|s,t<0||t>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+t+" <= "+e.buffer.byteLength);if(i<0||s>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+i+" <= "+this.buffer.byteLength);var a=s-i;return 0===a?e:(e.ensureCapacity(t+a),e.view.set(this.view.subarray(i,s),t),r&&(this.offset+=a),o&&(e.offset+=a),this)},o.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},o.fill=function(e,t,i){var s=void 0===t;if(s&&(t=this.offset),"string"==typeof e&&e.length>0&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(t>=i)return this;for(;t<i;)this.view[t++]=e;return s&&(this.offset=t),this},o.flip=function(){return this.limit=this.offset,this.offset=0,this},o.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},o.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},o.LE=function(e){return this.littleEndian=void 0===e||!!e,this},o.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},o.prepend=function(e,t,i){"number"!=typeof t&&"string"==typeof t||(i=t,t=void 0);var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}e instanceof n||(e=n.wrap(e,t));var r=e.limit-e.offset;if(r<=0)return this;var o=r-i;if(o>0){var a=new ArrayBuffer(this.buffer.byteLength+o),h=new Uint8Array(a);h.set(this.view.subarray(i,this.buffer.byteLength),r),this.buffer=a,this.view=h,this.offset+=o,this.markedOffset>=0&&(this.markedOffset+=o),this.limit+=o,i+=o}else{new Uint8Array(this.buffer)}return this.view.set(e.view.subarray(e.offset,e.limit),i-r),e.offset=e.limit,s&&(this.offset-=r),this},o.prependTo=function(e,t){return e.prepend(this,t),this},o.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},o.remaining=function(){return this.limit-this.offset},o.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},o.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e),i=new Uint8Array(t);i.set(this.view),this.buffer=t,this.view=i}return this},o.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t?this:(Array.prototype.reverse.call(this.view.subarray(e,t)),this)},o.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},o.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var i=this.clone();return i.offset=e,i.limit=t,i},o.toBuffer=function(e){var t=this.offset,i=this.limit;if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal limit: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(!e&&0===t&&i===this.buffer.byteLength)return this.buffer;if(t===i)return a;var s=new ArrayBuffer(i-t);return new Uint8Array(s).set(new Uint8Array(this.buffer).subarray(t,i),0),s},o.toArrayBuffer=o.toBuffer,o.toString=function(e,t,i){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(e="utf8",t=e,i=t),e){case"utf8":return this.toUTF8(t,i);case"base64":return this.toBase64(t,i);case"hex":return this.toHex(t,i);case"binary":return this.toBinary(t,i);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var l=function(){for(var e={},t=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],i=[],s=0,r=t.length;s<r;++s)i[t[s]]=s;return e.encode=function(e,i){for(var s,r;null!==(s=e());)i(t[s>>2&63]),r=(3&s)<<4,null!==(s=e())?(r|=s>>4&15,i(t[63&(r|s>>4&15)]),r=(15&s)<<2,null!==(s=e())?(i(t[63&(r|s>>6&3)]),i(t[63&s])):(i(t[63&r]),i(61))):(i(t[63&r]),i(61),i(61))},e.decode=function(e,t){function s(e){throw Error("Illegal character code: "+e)}for(var r,n,o;null!==(r=e());)if(n=i[r],void 0===n&&s(r),null!==(r=e())&&(o=i[r],void 0===o&&s(r),t(n<<2>>>0|(48&o)>>4),null!==(r=e()))){if(void 0===(n=i[r])){if(61===r)break;s(r)}if(t((15&o)<<4>>>0|(60&n)>>2),null!==(r=e())){if(void 0===(o=i[r])){if(61===r)break;s(r)}t((3&n)<<6>>>0|o)}}},e.test=function(e){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e)},e}();o.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),e|=0,t|=0,e<0||t>this.capacity||e>t)throw RangeError("begin, end");var s;return l.encode(function(){return e<t?this.view[e++]:null}.bind(this),s=i()),s()},n.fromBase64=function(e,i){if("string"!=typeof e)throw TypeError("str");var s=new n(e.length/4*3,i),r=0;return l.decode(t(e),function(e){s.view[r++]=e}),s.limit=r,s},n.btoa=function(e){return n.fromBinary(e).toBase64()},n.atob=function(e){return n.fromBase64(e).toBinary()},o.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),e|=0,t|=0,e<0||t>this.capacity()||e>t)throw RangeError("begin, end");if(e===t)return"";for(var i=[],s=[];e<t;)i.push(this.view[e++]),i.length>=1024&&(s.push(String.fromCharCode.apply(String,i)),i=[]);return s.join("")+String.fromCharCode.apply(String,i)},n.fromBinary=function(e,t){if("string"!=typeof e)throw TypeError("str");for(var i,s=0,r=e.length,o=new n(r,t);s<r;){if((i=e.charCodeAt(s))>255)throw RangeError("illegal char code: "+i);o.view[s++]=i}return o.limit=r,o},o.toDebug=function(e){for(var t,i=-1,s=this.buffer.byteLength,r="",n="",o="";i<s;){if(i!==-1&&(t=this.view[i],r+=t<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(n+=t>32&&t<127?String.fromCharCode(t):".")),++i,e&&i>0&&i%16==0&&i!==s){for(;r.length<51;)r+=" ";o+=r+n+"\n",r=n=""}i===this.offset&&i===this.limit?r+=i===this.markedOffset?"!":"|":i===this.offset?r+=i===this.markedOffset?"[":"<":i===this.limit?r+=i===this.markedOffset?"]":">":r+=i===this.markedOffset?"'":e||0!==i&&i!==s?" ":""}if(e&&" "!==r){for(;r.length<51;)r+=" ";o+=r+n+"\n"}return e?o:r},n.fromDebug=function(e,t,i){for(var s,r,o=e.length,a=new n((o+1)/3|0,t,i),h=0,l=0,f=!1,u=!1,c=!1,d=!1,g=!1;h<o;){switch(s=e.charAt(h++)){case"!":if(!i){if(u||c||d){g=!0;break}u=c=d=!0}a.offset=a.markedOffset=a.limit=l,f=!1;break;case"|":if(!i){if(u||d){g=!0;break}u=d=!0}a.offset=a.limit=l,f=!1;break;case"[":if(!i){if(u||c){g=!0;break}u=c=!0}a.offset=a.markedOffset=l,f=!1;break;case"<":if(!i){if(u){g=!0;break}u=!0}a.offset=l,f=!1;break;case"]":if(!i){if(d||c){g=!0;break}d=c=!0}a.limit=a.markedOffset=l,f=!1;break;case">":if(!i){if(d){g=!0;break}d=!0}a.limit=l,f=!1;break;case"'":if(!i){if(c){g=!0;break}c=!0}a.markedOffset=l,f=!1;break;case" ":f=!1;break;default:if(!i&&f){g=!0;break}if(r=parseInt(s+e.charAt(h++),16),!i&&(isNaN(r)||r<0||r>255))throw TypeError("Illegal str: Not a debug encoded string");a.view[l++]=r,f=!0}if(g)throw TypeError("Illegal str: Invalid symbol at "+h)}if(!i){if(!u||!d)throw TypeError("Illegal str: Missing offset or limit");if(l<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+l+" < "+o)}return a},o.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var i,s=new Array(t-e);e<t;)i=this.view[e++],i<16?s.push("0",i.toString(16)):s.push(i.toString(16));return s.join("")},n.fromHex=function(e,t,i){if(!i){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var s,r=e.length,o=new n(r/2|0,t),a=0,h=0;a<r;a+=2){if(s=parseInt(e.substring(a,a+2),16),!i&&(!isFinite(s)||s<0||s>255))throw TypeError("Illegal str: Contains non-hex characters");o.view[h++]=s}return o.limit=h,o};var f=function(){var e={};return e.MAX_CODEPOINT=1114111,e.encodeUTF8=function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)i<128?t(127&i):i<2048?(t(i>>6&31|192),t(63&i|128)):i<65536?(t(i>>12&15|224),t(i>>6&63|128),t(63&i|128)):(t(i>>18&7|240),t(i>>12&63|128),t(i>>6&63|128),t(63&i|128)),i=null},e.decodeUTF8=function(e,t){for(var i,s,r,n,o=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(i=e());)if(0==(128&i))t(i);else if(192==(224&i))null===(s=e())&&o([i,s]),t((31&i)<<6|63&s);else if(224==(240&i))(null===(s=e())||null===(r=e()))&&o([i,s,r]),t((15&i)<<12|(63&s)<<6|63&r);else{if(240!=(248&i))throw RangeError("Illegal starting byte: "+i);(null===(s=e())||null===(r=e())||null===(n=e()))&&o([i,s,r,n]),t((7&i)<<18|(63&s)<<12|(63&r)<<6|63&n)}},e.UTF16toUTF8=function(e,t){for(var i,s=null;;){if(null===(i=null!==s?s:e()))break;i>=55296&&i<=57343&&null!==(s=e())&&s>=56320&&s<=57343?(t(1024*(i-55296)+s-56320+65536),s=null):t(i)}null!==s&&t(s)},e.UTF8toUTF16=function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)i<=65535?t(i):(i-=65536,t(55296+(i>>10)),t(i%1024+56320)),i=null},e.encodeUTF16toUTF8=function(t,i){e.UTF16toUTF8(t,function(t){e.encodeUTF8(t,i)})},e.decodeUTF8toUTF16=function(t,i){e.decodeUTF8(t,function(t){e.UTF8toUTF16(t,i)})},e.calculateCodePoint=function(e){return e<128?1:e<2048?2:e<65536?3:4},e.calculateUTF8=function(e){for(var t,i=0;null!==(t=e());)i+=t<128?1:t<2048?2:t<65536?3:4;return i},e.calculateUTF16asUTF8=function(t){var i=0,s=0;return e.UTF16toUTF8(t,function(e){++i,s+=e<128?1:e<2048?2:e<65536?3:4}),[i,s]},e}();return o.toUTF8=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var s;try{f.decodeUTF8toUTF16(function(){return e<t?this.view[e++]:null}.bind(this),s=i())}catch(i){if(e!==t)throw RangeError("Illegal range: Truncated data, "+e+" != "+t)}return s()},n.fromUTF8=function(e,i,s){if(!s&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var r=new n(f.calculateUTF16asUTF8(t(e),!0)[1],i,s),o=0;return f.encodeUTF16toUTF8(t(e),function(e){r.view[o++]=e}),r.limit=o,r},n}),function(e,t){"function"==typeof define&&define.amd?define(["/v2/web/boss/js/module/chat-bytebuffer.js"],function(){(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t(require("bytebuffer"),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}(this,function(e,t){"use strict";var i={};return i.ByteBuffer=e,i.Long=e.Long||null,i.VERSION="5.0.1",i.WIRE_TYPES={},i.WIRE_TYPES.VARINT=0,i.WIRE_TYPES.BITS64=1,i.WIRE_TYPES.LDELIM=2,i.WIRE_TYPES.STARTGROUP=3,i.WIRE_TYPES.ENDGROUP=4,i.WIRE_TYPES.BITS32=5,i.PACKABLE_WIRE_TYPES=[i.WIRE_TYPES.VARINT,i.WIRE_TYPES.BITS64,i.WIRE_TYPES.BITS32],i.TYPES={int32:{name:"int32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},uint64:{name:"uint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.UZERO:void 0},sint64:{name:"sint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},bool:{name:"bool",wireType:i.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:i.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:i.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.ZERO:void 0},float:{name:"float",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:i.WIRE_TYPES.STARTGROUP,defaultValue:null}},i.MAP_KEY_TYPES=[i.TYPES.int32,i.TYPES.sint32,i.TYPES.sfixed32,i.TYPES.uint32,i.TYPES.fixed32,i.TYPES.int64,i.TYPES.sint64,i.TYPES.sfixed64,i.TYPES.uint64,i.TYPES.fixed64,i.TYPES.bool,i.TYPES.string,i.TYPES.bytes],i.ID_MIN=1,i.ID_MAX=536870911,i.convertFieldsToCamelCase=!1,i.populateAccessors=!0,i.populateDefaults=!0,i.Util=function(){var e={};return e.IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),e.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,i=0;i<e.length;i++){try{t=e[i]()}catch(e){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},e.fetch=function(t,i){if(i&&"function"!=typeof i&&(i=null),e.IS_NODE){var s=require("fs");if(i)s.readFile(t,function(e,t){i(e?null:""+t)});else try{return s.readFileSync(t)}catch(e){return null}}else{var r=e.XHR();if(r.open("GET",t,!!i),r.setRequestHeader("Accept","text/plain"),"function"==typeof r.overrideMimeType&&r.overrideMimeType("text/plain"),!i)return r.send(null),200==r.status||0==r.status&&"string"==typeof r.responseText?r.responseText:null;if(r.onreadystatechange=function(){4==r.readyState&&i(200==r.status||0==r.status&&"string"==typeof r.responseText?r.responseText:null)},4==r.readyState)return;r.send(null)}},e.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},e}(),i.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},i.DotProto=function(e,t){function i(e,i){var s=-1,r=1;if("-"==e.charAt(0)&&(r=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))s=parseInt(e);else if(t.NUMBER_HEX.test(e))s=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error("illegal id value: "+(r<0?"-":"")+e);s=parseInt(e.substring(1),8)}if(s=r*s|0,!i&&s<0)throw Error("illegal id value: "+(r<0?"-":"")+e);return s}function s(e){var i=1;if("-"==e.charAt(0)&&(i=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return i*parseInt(e,10);if(t.NUMBER_HEX.test(e))return i*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return i*parseInt(e.substring(1),8);if("inf"===e)return i*(1/0);if("nan"===e)return NaN;if(t.NUMBER_FLT.test(e))return i*parseFloat(e);throw Error("illegal number value: "+(i<0?"-":"")+e)}function r(e,t,i){void 0===e[t]?e[t]=i:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(i))}var n={},o=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},a=o.prototype;a._readString=function(){var e='"'===this._stringOpen?t.STRING_DQ:t.STRING_SQ;e.lastIndex=this.index-1;var i=e.exec(this.source);if(!i)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,i[1]},a.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,i,s;do{for(e=!1;t.WHITESPACE.test(s=this.source.charAt(this.index));)if("\n"===s&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(s=this.source.charAt(this.index)))return"/";do{if("\n"===s&&++this.line,++this.index===this.source.length)return null;i=s,s=this.source.charAt(this.index)}while("*"!==i||"/"!==s);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;var r=this.index;if(t.DELIM.lastIndex=0,!t.DELIM.test(this.source.charAt(r++)))for(;r<this.source.length&&!t.DELIM.test(this.source.charAt(r));)++r;var n=this.source.substring(this.index,this.index=r);return'"'!==n&&"'"!==n||(this._stringOpen=n),n},a.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},a.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},a.omit=function(e){return this.peek()===e&&(this.next(),!0)},a.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},n.Tokenizer=o;var h=function(e){this.tn=new o(e),this.proto3=!1},l=h.prototype;return l.parse=function(){var e,i,s={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},r=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!r||null!==s.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),s.package=e;break;case"import":if(!r)throw Error("unexpected 'import'");e=this.tn.peek(),("public"===e||(i="weak"===e))&&this.tn.next(),e=this._readString(),this.tn.skip(";"),i||s.imports.push(e);break;case"syntax":if(!r)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(s.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(s,null),r=!1;break;case"enum":this._parseEnum(s),r=!1;break;case"option":this._parseOption(s);break;case"service":this._parseService(s);break;case"extend":this._parseExtend(s);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete s.name,s},h.parse=function(e){return new h(e).parse()},l._readString=function(){var e,t,i="";do{if("'"!==(t=this.tn.next())&&'"'!==t)throw Error("illegal string delimiter: "+t);i+=this.tn.next(),this.tn.skip(t),e=this.tn.peek()}while('"'===e||'"'===e);return i},l._readValue=function(e){var i=this.tn.peek();if('"'===i||"'"===i)return this._readString();if(this.tn.next(),t.NUMBER.test(i))return s(i);if(t.BOOL.test(i))return"true"===i.toLowerCase();if(e&&t.TYPEREF.test(i))return i;throw Error("illegal value: "+i)},l._parseOption=function(e,i){var s=this.tn.next(),r=!1;if("("===s&&(r=!0,s=this.tn.next()),!t.TYPEREF.test(s))throw Error("illegal option name: "+s);var n=s;r&&(this.tn.skip(")"),n="("+n+")",s=this.tn.peek(),t.FQTYPEREF.test(s)&&(n+=s,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,n),i||this.tn.skip(";")},l._parseOptionValue=function(e,i){var s=this.tn.peek();if("{"!==s)r(e.options,i,this._readValue(!0));else for(this.tn.skip("{");"}"!==(s=this.tn.next());){if(!t.NAME.test(s))throw Error("illegal option name: "+i+"."+s);this.tn.omit(":")?r(e.options,i+"."+s,this._readValue(!0)):this._parseOptionValue(e,i+"."+s)}},l._parseService=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal service name at line "+this.tn.line+": "+i);var s=i,r={name:s,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if("option"===i)this._parseOption(r);else{if("rpc"!==i)throw Error("illegal service token: "+i);this._parseServiceRPC(r)}this.tn.omit(";"),e.services.push(r)},l._parseServiceRPC=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal rpc service method name: "+i);var s=i,r={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),i=this.tn.next(),"stream"===i.toLowerCase()&&(r.request_stream=!0,i=this.tn.next()),!t.TYPEREF.test(i))throw Error("illegal rpc service request type: "+i);if(r.request=i,this.tn.skip(")"),i=this.tn.next(),"returns"!==i.toLowerCase())throw Error("illegal rpc service request type delimiter: "+i);if(this.tn.skip("("),i=this.tn.next(),"stream"===i.toLowerCase()&&(r.response_stream=!0,i=this.tn.next()),r.response=i,this.tn.skip(")"),"{"===(i=this.tn.peek())){for(this.tn.next();"}"!==(i=this.tn.next());){if("option"!==i)throw Error("illegal rpc service token: "+i);this._parseOption(r)}this.tn.omit(";")}else this.tn.skip(";");void 0===e.rpc&&(e.rpc={}),e.rpc[s]=r},l._parseMessage=function(e,s){var r=!!s,n=this.tn.next(),o={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!t.NAME.test(n))throw Error("illegal "+(r?"group":"message")+" name: "+n);for(o.name=n,
r&&(this.tn.skip("="),s.id=i(this.tn.next()),o.isGroup=!0),n=this.tn.peek(),"["===n&&s&&this._parseFieldOptions(s),this.tn.skip("{");"}"!==(n=this.tn.next());)if(t.RULE.test(n))this._parseMessageField(o,n);else if("oneof"===n)this._parseMessageOneOf(o);else if("enum"===n)this._parseEnum(o);else if("message"===n)this._parseMessage(o);else if("option"===n)this._parseOption(o);else if("service"===n)this._parseService(o);else if("extensions"===n)o.hasOwnProperty("extensions")?o.extensions=o.extensions.concat(this._parseExtensionRanges()):o.extensions=this._parseExtensionRanges();else if("reserved"===n)this._parseIgnored();else if("extend"===n)this._parseExtend(o);else{if(!t.TYPEREF.test(n))throw Error("illegal message token: "+n);if(!this.proto3)throw Error("illegal field rule: "+n);this._parseMessageField(o,"optional",n)}return this.tn.omit(";"),e.messages.push(o),o},l._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},l._parseMessageField=function(e,s,r){if(!t.RULE.test(s))throw Error("illegal message field rule: "+s);var n,o={rule:s,type:"",name:"",options:{},id:0};if("map"===s){if(r)throw Error("illegal type: "+r);if(this.tn.skip("<"),n=this.tn.next(),!t.TYPE.test(n)&&!t.TYPEREF.test(n))throw Error("illegal message field type: "+n);if(o.keytype=n,this.tn.skip(","),n=this.tn.next(),!t.TYPE.test(n)&&!t.TYPEREF.test(n))throw Error("illegal message field: "+n);if(o.type=n,this.tn.skip(">"),n=this.tn.next(),!t.NAME.test(n))throw Error("illegal message field name: "+n);o.name=n,this.tn.skip("="),o.id=i(this.tn.next()),n=this.tn.peek(),"["===n&&this._parseFieldOptions(o),this.tn.skip(";")}else if("group"===(r=void 0!==r?r:this.tn.next())){var a=this._parseMessage(e,o);if(!/^[A-Z]/.test(a.name))throw Error("illegal group name: "+a.name);o.type=a.name,o.name=a.name.toLowerCase(),this.tn.omit(";")}else{if(!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(o.type=r,n=this.tn.next(),!t.NAME.test(n))throw Error("illegal message field name: "+n);o.name=n,this.tn.skip("="),o.id=i(this.tn.next()),n=this.tn.peek(),"["===n&&this._parseFieldOptions(o),this.tn.skip(";")}return e.fields.push(o),o},l._parseMessageOneOf=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal oneof name: "+i);var s,r=i,n=[];for(this.tn.skip("{");"}"!==(i=this.tn.next());)s=this._parseMessageField(e,"optional",i),s.oneof=r,n.push(s.id);this.tn.omit(";"),e.oneofs[r]=n},l._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},l._parseEnum=function(e){var s={name:"",values:[],options:{}},r=this.tn.next();if(!t.NAME.test(r))throw Error("illegal name: "+r);for(s.name=r,this.tn.skip("{");"}"!==(r=this.tn.next());)if("option"===r)this._parseOption(s);else{if(!t.NAME.test(r))throw Error("illegal name: "+r);this.tn.skip("=");var n={name:r,id:i(this.tn.next(),!0)};r=this.tn.peek(),"["===r&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),s.values.push(n)}this.tn.omit(";"),e.enums.push(s)},l._parseExtensionRanges=function(){var t,i,r,n=[];do{for(i=[];;){switch(t=this.tn.next()){case"min":r=e.ID_MIN;break;case"max":r=e.ID_MAX;break;default:r=s(t)}if(i.push(r),2===i.length)break;if("to"!==this.tn.peek()){i.push(r);break}this.tn.next()}n.push(i)}while(this.tn.omit(","));return this.tn.skip(";"),n},l._parseExtend=function(e){var i=this.tn.next();if(!t.TYPEREF.test(i))throw Error("illegal extend reference: "+i);var s={ref:i,fields:[]};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if(t.RULE.test(i))this._parseMessageField(s,i);else{if(!t.TYPEREF.test(i))throw Error("illegal extend token: "+i);if(!this.proto3)throw Error("illegal field rule: "+i);this._parseMessageField(s,"optional",i)}return this.tn.omit(";"),e.messages.push(s),s},l.toString=function(){return"Parser at line "+this.tn.line},n.Parser=h,n}(i,i.Lang),i.Reflect=function(t){function i(i){if("string"==typeof i&&(i=t.TYPES[i]),void 0===i.defaultValue)throw Error("default value for type "+i.name+" is not supported");return i==t.TYPES.bytes?new e(0):i.defaultValue}function s(e,i){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low===e.low&&e.high===e.high)return new t.Long(e.low,e.high,void 0===i?e.unsigned:i);if("string"==typeof e)return t.Long.fromString(e,i||!1,10);if("number"==typeof e)return t.Long.fromNumber(e,i||!1);throw Error("not convertible to Long")}function r(e,i){var s=i.readVarint32(),n=7&s,o=s>>>3;switch(n){case t.WIRE_TYPES.VARINT:do{s=i.readUint8()}while(128==(128&s));break;case t.WIRE_TYPES.BITS64:i.offset+=8;break;case t.WIRE_TYPES.LDELIM:s=i.readVarint32(),i.offset+=s;break;case t.WIRE_TYPES.STARTGROUP:r(o,i);break;case t.WIRE_TYPES.ENDGROUP:if(o===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+o+" ("+e+" expected)");case t.WIRE_TYPES.BITS32:i.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+n)}return!0}var n={},o=function(e,t,i){this.builder=e,this.parent=t,this.name=i,this.className},a=o.prototype;a.fqn=function(){for(var e=this.name,t=this;;){if(null==(t=t.parent))break;e=t.name+"."+e}return e},a.toString=function(e){return(e?this.className+" ":"")+this.fqn()},a.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},n.T=o;var h=function(e,t,i,s,r){o.call(this,e,t,i),this.className="Namespace",this.children=[],this.options=s||{},this.syntax=r||"proto2"},l=h.prototype=Object.create(o.prototype);l.getChildren=function(e){if(null==(e=e||null))return this.children.slice();for(var t=[],i=0,s=this.children.length;i<s;++i)this.children[i]instanceof e&&t.push(this.children[i]);return t},l.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof c.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof c.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},l.getChild=function(e){for(var t="number"==typeof e?"id":"name",i=0,s=this.children.length;i<s;++i)if(this.children[i][t]===e)return this.children[i];return null},l.resolve=function(e,t){var i="string"==typeof e?e.split("."):e,s=this,r=0;if(""===i[r]){for(;null!==s.parent;)s=s.parent;r++}var o;do{do{if(!(s instanceof n.Namespace)){s=null;break}if(!(o=s.getChild(i[r]))||!(o instanceof n.T)||t&&!(o instanceof n.Namespace)){s=null;break}s=o,r++}while(r<i.length);if(null!=s)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=s);return s},l.qn=function(e){var t=[],i=e;do{t.unshift(i.name),i=i.parent}while(null!==i);for(var s=1;s<=t.length;s++){var r=t.slice(t.length-s);if(e===this.resolve(r,e instanceof n.Namespace))return r.join(".")}return e.fqn()},l.build=function(){for(var e,t={},i=this.children,s=0,r=i.length;s<r;++s)(e=i[s])instanceof h&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},l.buildOpt=function(){for(var e={},t=Object.keys(this.options),i=0,s=t.length;i<s;++i){var r=t[i],n=this.options[t[i]];e[r]=n}return e},l.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},n.Namespace=h;var f=function(e,i,s,r,n){if(this.type=e,this.resolvedType=i,this.isMapKey=s,this.syntax=r,this.name=n,s&&t.MAP_KEY_TYPES.indexOf(e)<0)throw Error("Invalid map key type: "+e.name)},u=f.prototype;f.defaultFieldValue=i,u.toString=function(){return(this.name||"")+(this.isMapKey?"map":"value")+" element"},u.verifyValue=function(i){function r(e,t){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+e+" ("+t+")")}var n=this;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return("number"!=typeof i||i===i&&i%1!=0)&&r(typeof i,"not an integer"),i>4294967295?0|i:i;case t.TYPES.uint32:case t.TYPES.fixed32:return("number"!=typeof i||i===i&&i%1!=0)&&r(typeof i,"not an integer"),i<0?i>>>0:i;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return s(i,!1)}catch(e){r(typeof i,e.message)}else r(typeof i,"requires Long.js");case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return s(i,!0)}catch(e){r(typeof i,e.message)}else r(typeof i,"requires Long.js");case t.TYPES.bool:return"boolean"!=typeof i&&r(typeof i,"not a boolean"),i;case t.TYPES.float:case t.TYPES.double:return"number"!=typeof i&&r(typeof i,"not a number"),i;case t.TYPES.string:return"string"==typeof i||i&&i instanceof String||r(typeof i,"not a string"),""+i;case t.TYPES.bytes:return e.isByteBuffer(i)?i:e.wrap(i,"base64");case t.TYPES.enum:var o=this.resolvedType.getChildren(t.Reflect.Enum.Value);for(h=0;h<o.length;h++){if(o[h].name==i)return o[h].id;if(o[h].id==i)return o[h].id}if("proto3"===this.syntax)return("number"!=typeof i||i===i&&i%1!=0)&&r(typeof i,"not an integer"),(i>4294967295||i<0)&&r(typeof i,"not in range for uint32"),i;r(i,"not a valid enum value");case t.TYPES.group:case t.TYPES.message:if(i&&"object"==typeof i||r(typeof i,"object expected"),i instanceof this.resolvedType.clazz)return i;if(i instanceof t.Builder.Message){var a={};for(var h in i)i.hasOwnProperty(h)&&(a[h]=i[h]);i=a}return new this.resolvedType.clazz(i)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+i+" (undefined type "+this.type+")")},u.calculateLength=function(i,s){if(null===s)return 0;var r;switch(this.type){case t.TYPES.int32:return s<0?e.calculateVarint64(s):e.calculateVarint32(s);case t.TYPES.uint32:return e.calculateVarint32(s);case t.TYPES.sint32:return e.calculateVarint32(e.zigZagEncode32(s));case t.TYPES.fixed32:case t.TYPES.sfixed32:case t.TYPES.float:return 4;case t.TYPES.int64:case t.TYPES.uint64:return e.calculateVarint64(s);case t.TYPES.sint64:return e.calculateVarint64(e.zigZagEncode64(s));case t.TYPES.fixed64:case t.TYPES.sfixed64:return 8;case t.TYPES.bool:return 1;case t.TYPES.enum:return e.calculateVarint32(s);case t.TYPES.double:return 8;case t.TYPES.string:return r=e.calculateUTF8Bytes(s),e.calculateVarint32(r)+r;case t.TYPES.bytes:if(s.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+s.remaining()+" bytes remaining");return e.calculateVarint32(s.remaining())+s.remaining();case t.TYPES.message:return r=this.resolvedType.calculate(s),e.calculateVarint32(r)+r;case t.TYPES.group:return(r=this.resolvedType.calculate(s))+e.calculateVarint32(i<<3|t.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+s+" (unknown type)")},u.encodeValue=function(i,s,r){if(null===s)return r;switch(this.type){case t.TYPES.int32:s<0?r.writeVarint64(s):r.writeVarint32(s);break;case t.TYPES.uint32:r.writeVarint32(s);break;case t.TYPES.sint32:r.writeVarint32ZigZag(s);break;case t.TYPES.fixed32:r.writeUint32(s);break;case t.TYPES.sfixed32:r.writeInt32(s);break;case t.TYPES.int64:case t.TYPES.uint64:r.writeVarint64(s);break;case t.TYPES.sint64:r.writeVarint64ZigZag(s);break;case t.TYPES.fixed64:r.writeUint64(s);break;case t.TYPES.sfixed64:r.writeInt64(s);break;case t.TYPES.bool:"string"==typeof s?r.writeVarint32("false"===s.toLowerCase()?0:!!s):r.writeVarint32(s?1:0);break;case t.TYPES.enum:r.writeVarint32(s);break;case t.TYPES.float:r.writeFloat32(s);break;case t.TYPES.double:r.writeFloat64(s);break;case t.TYPES.string:r.writeVString(s);break;case t.TYPES.bytes:if(s.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+s.remaining()+" bytes remaining");var n=s.offset;r.writeVarint32(s.remaining()),r.append(s),s.offset=n;break;case t.TYPES.message:var o=(new e).LE();this.resolvedType.encode(s,o),r.writeVarint32(o.offset),r.append(o.flip());break;case t.TYPES.group:this.resolvedType.encode(s,r),r.writeVarint32(i<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+s+" (unknown type)")}return r},u.decode=function(e,i,s){if(i!=this.type.wireType)throw Error("Unexpected wire type for element");var r,n;switch(this.type){case t.TYPES.int32:return 0|e.readVarint32();case t.TYPES.uint32:return e.readVarint32()>>>0;case t.TYPES.sint32:return 0|e.readVarint32ZigZag();case t.TYPES.fixed32:return e.readUint32()>>>0;case t.TYPES.sfixed32:return 0|e.readInt32();case t.TYPES.int64:return e.readVarint64();case t.TYPES.uint64:return e.readVarint64().toUnsigned();case t.TYPES.sint64:return e.readVarint64ZigZag();case t.TYPES.fixed64:return e.readUint64();case t.TYPES.sfixed64:return e.readInt64();case t.TYPES.bool:return!!e.readVarint32();case t.TYPES.enum:return e.readVarint32();case t.TYPES.float:return e.readFloat();case t.TYPES.double:return e.readDouble();case t.TYPES.string:return e.readVString();case t.TYPES.bytes:if(n=e.readVarint32(),e.remaining()<n)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+n+" required but got only "+e.remaining());return r=e.clone(),r.limit=r.offset+n,e.offset+=n,r;case t.TYPES.message:return n=e.readVarint32(),this.resolvedType.decode(e,n);case t.TYPES.group:return this.resolvedType.decode(e,-1,s)}throw Error("[INTERNAL] Illegal decode type")},u.valueFromString=function(i){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return this.verifyValue(parseInt(i));case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return this.verifyValue(i);case t.TYPES.bool:return"true"===i;case t.TYPES.string:return this.verifyValue(i);case t.TYPES.bytes:return e.fromBinary(i)}},u.valueToString=function(e){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===t.TYPES.bytes?e.toString("binary"):e.toString()},n.Element=f;var c=function(e,t,i,s,r,n){h.call(this,e,t,i,s,n),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!r,this._fields=null,this._fieldsById=null,this._fieldsByName=null},d=c.prototype=Object.create(h.prototype);d.build=function(i){if(this.clazz&&!i)return this.clazz;var s=function(t,i){function s(i,r,n,o){if(null===i||"object"!=typeof i){if(o&&o instanceof t.Reflect.Enum){var a=t.Reflect.Enum.getName(o.object,i);if(null!==a)return a}return i}if(e.isByteBuffer(i))return r?i.toBase64():i.toBuffer();if(t.Long.isLong(i))return n?i.toString():t.Long.fromValue(i);var h;if(Array.isArray(i))return h=[],i.forEach(function(e,t){h[t]=s(e,r,n,o)}),h;if(h={},i instanceof t.Map){for(var l=i.entries(),f=l.next();!f.done;f=l.next())h[i.keyElem.valueToString(f.value[0])]=s(f.value[1],r,n,i.valueElem.resolvedType);return h}var u=i.$type,c=void 0;for(var d in i)i.hasOwnProperty(d)&&(u&&(c=u.getChild(d))?h[d]=s(i[d],r,n,c.resolvedType):h[d]=s(i[d],r,n));return h}var r=i.getChildren(t.Reflect.Message.Field),n=i.getChildren(t.Reflect.Message.OneOf),o=function(s,a){t.Builder.Message.call(this);for(var h=0,l=n.length;h<l;++h)this[n[h].name]=null;for(h=0,l=r.length;h<l;++h){var f=r[h];this[f.name]=f.repeated?[]:f.map?new t.Map(f):null,!f.required&&"proto3"!==i.syntax||null===f.defaultValue||(this[f.name]=f.defaultValue)}if(arguments.length>0){var u;if(1!==arguments.length||null===s||"object"!=typeof s||!("function"!=typeof s.encode||s instanceof o)||Array.isArray(s)||s instanceof t.Map||e.isByteBuffer(s)||s instanceof ArrayBuffer||t.Long&&s instanceof t.Long)for(h=0,l=arguments.length;h<l;++h)void 0!==(u=arguments[h])&&this.$set(r[h].name,u);else this.$set(s)}},a=o.prototype=Object.create(t.Builder.Message.prototype);a.add=function(e,s,r){var n=i._fieldsByName[e];if(!r){if(!n)throw Error(this+"#"+e+" is undefined");if(!(n instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+n.toString(!0));if(!n.repeated)throw Error(this+"#"+e+" is not a repeated field");s=n.verifyValue(s,!0)}return null===this[e]&&(this[e]=[]),this[e].push(s),this},a.$add=a.add,a.set=function(e,s,r){if(e&&"object"==typeof e){r=s;for(var n in e)e.hasOwnProperty(n)&&void 0!==(s=e[n])&&this.$set(n,s,r);return this}var o=i._fieldsByName[e];if(r)this[e]=s;else{if(!o)throw Error(this+"#"+e+" is not a field: undefined");if(!(o instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+o.toString(!0));this[o.name]=s=o.verifyValue(s)}if(o&&o.oneof){var a=this[o.oneof.name];null!==s?(null!==a&&a!==o.name&&(this[a]=null),this[o.oneof.name]=o.name):a===e&&(this[o.oneof.name]=null)}return this},a.$set=a.set,a.get=function(e,s){if(s)return this[e];var r=i._fieldsByName[e];if(!(r&&r instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(r instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+r.toString(!0));return this[r.name]},a.$get=a.get;for(var h=0;h<r.length;h++){var l=r[h];l instanceof t.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(e){var t=e.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")});t=t.substring(0,1).toUpperCase()+t.substring(1);var s=e.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),r=function(t,i){return this[e.name]=i?t:e.verifyValue(t),this},n=function(){return this[e.name]};null===i.getChild("set"+t)&&(a["set"+t]=r),null===i.getChild("set_"+s)&&(a["set_"+s]=r),null===i.getChild("get"+t)&&(a["get"+t]=n),null===i.getChild("get_"+s)&&(a["get_"+s]=n)}(l)}a.encode=function(t,s){"boolean"==typeof t&&(s=t,t=void 0);var r=!1;t||(t=new e,r=!0);var n=t.littleEndian;try{return i.encode(this,t.LE(),s),(r?t.flip():t).LE(n)}catch(e){throw t.LE(n),e}},o.encode=function(e,t,i){return new o(e).encode(t,i)},a.calculate=function(){return i.calculate(this)},a.encodeDelimited=function(t,s){var r=!1;t||(t=new e,r=!0);var n=(new e).LE();return i.encode(this,n,s).flip(),t.writeVarint32(n.remaining()),t.append(n),r?t.flip():t},a.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},a.toArrayBuffer=a.encodeAB,a.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},a.toBuffer=a.encodeNB,a.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},a.toBase64=a.encode64,a.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},a.toHex=a.encodeHex,a.toRaw=function(e,t){return s(this,!!e,!!t,this.$type)},a.encodeJSON=function(){return JSON.stringify(s(this,!0,!0,this.$type))},o.decode=function(t,s,r){"string"==typeof s&&(r=s,s=-1),"string"==typeof t?t=e.wrap(t,r?r:"base64"):e.isByteBuffer(t)||(t=e.wrap(t));var n=t.littleEndian;try{var o=i.decode(t.LE(),s);return t.LE(n),o}catch(e){throw t.LE(n),e}},o.decodeDelimited=function(t,s){if("string"==typeof t?t=e.wrap(t,s?s:"base64"):e.isByteBuffer(t)||(t=e.wrap(t)),t.remaining()<1)return null;var r=t.offset,n=t.readVarint32();if(t.remaining()<n)return t.offset=r,null;try{var o=i.decode(t.slice(t.offset,t.offset+n).LE());return t.offset+=n,o}catch(e){throw t.offset+=n,e}},o.decode64=function(e){return o.decode(e,"base64")},o.decodeHex=function(e){return o.decode(e,"hex")},o.decodeJSON=function(e){return new o(JSON.parse(e))},a.toString=function(){return i.toString()};return Object.defineProperty&&(Object.defineProperty(o,"$options",{value:i.buildOpt()}),Object.defineProperty(a,"$options",{value:o.$options}),Object.defineProperty(o,"$type",{value:i}),Object.defineProperty(a,"$type",{value:i})),o}(t,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,n=0,o=this.children.length;n<o;n++)if((r=this.children[n])instanceof v||r instanceof c||r instanceof E){if(s.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");s[r.name]=r.build()}else if(r instanceof c.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof c.OneOf||r instanceof w))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=s},d.encode=function(e,t,i){for(var s,r,n=null,o=0,a=this._fields.length;o<a;++o)s=this._fields[o],r=e[s.name],s.required&&null===r?null===n&&(n=s):s.encode(i?r:s.verifyValue(r),t,e);if(null!==n){var h=Error("Missing at least one required field for "+this.toString(!0)+": "+n);throw h.encoded=t,h}return t},d.calculate=function(e){for(var t,i,s=0,r=0,n=this._fields.length;r<n;++r){if(t=this._fields[r],i=e[t.name],t.required&&null===i)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);s+=t.calculate(i,e)}return s},d.decode=function(e,i,s){"number"!=typeof i&&(i=-1);for(var n,o,a,h,l=e.offset,f=new this.clazz;e.offset<l+i||i===-1&&e.remaining()>0;){if(n=e.readVarint32(),o=7&n,a=n>>>3,o===t.WIRE_TYPES.ENDGROUP){if(a!==s)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+a+" ("+(s?s+" expected":"not a group")+")");break}if(h=this._fieldsById[a]){if(h.repeated&&!h.options.packed)f[h.name].push(h.decode(o,e));else if(h.map){var u=h.decode(o,e);f[h.name].set(u[0],u[1])}else if(f[h.name]=h.decode(o,e),h.oneof){var c=f[h.oneof.name];null!==c&&c!==h.name&&(f[c]=null),f[h.oneof.name]=h.name}}else switch(o){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:var d=e.readVarint32();e.offset+=d;break;case t.WIRE_TYPES.STARTGROUP:for(;r(a,e););break;default:throw Error("Illegal wire type for unknown field "+a+" in "+this.toString(!0)+"#decode: "+o)}}for(var g=0,p=this._fields.length;g<p;++g)if(h=this._fields[g],null===f[h.name])if("proto3"===this.syntax)f[h.name]=h.defaultValue;else{if(h.required){var m=Error("Missing at least one required field for "+this.toString(!0)+": "+h.name);throw m.decoded=f,m}t.populateDefaults&&null!==h.defaultValue&&(f[h.name]=h.defaultValue)}return f},n.Message=c;var g=function(e,i,s,r,n,a,h,l,f,u){o.call(this,e,i,a),this.className="Message.Field",this.required="required"===s,this.repeated="repeated"===s,this.map="map"===s,this.keyType=r||null,this.type=n,this.resolvedType=null,this.id=h,this.options=l||{},this.defaultValue=null,this.oneof=f||null,this.syntax=u||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof c.ExtensionField||(this.name=t.Util.toCamelCase(this.name))},p=g.prototype=Object.create(o.prototype);p.build=function(){this.element=new f(this.type,this.resolvedType,!1,this.syntax,this.name),this.map&&(this.keyElement=new f(this.keyType,void 0,!0,this.syntax,this.name)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=f.defaultFieldValue(this.type)},p.verifyValue=function(e,i){function s(e,t){throw Error("Illegal value for "+r.toString(!0)+" of type "+r.type.name+": "+e+" ("+t+")")}i=i||!1;var r=this;if(null===e)return this.required&&s(typeof e,"required"),"proto3"===this.syntax&&this.type!==t.TYPES.message&&s(typeof e,"proto3 field without field presence cannot be null"),null;var n;if(this.repeated&&!i){Array.isArray(e)||(e=[e]);var o=[];for(n=0;n<e.length;n++)o.push(this.element.verifyValue(e[n]));return o}return this.map&&!i?e instanceof t.Map?e:(e instanceof Object||s(typeof e,"expected ProtoBuf.Map or raw object for map field"),new t.Map(this,e)):(!this.repeated&&Array.isArray(e)&&s(typeof e,"no array expected"),this.element.verifyValue(e))},p.hasWirePresence=function(e,i){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&i[this.oneof.name]===this.name)return!0;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return 0!==e;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return 0!==e.low||0!==e.high;case t.TYPES.bool:return e;case t.TYPES.float:case t.TYPES.double:return 0!==e;case t.TYPES.string:return e.length>0;case t.TYPES.bytes:return e.remaining()>0;case t.TYPES.enum:return 0!==e;case t.TYPES.message:return null!==e;default:return!0}},p.encode=function(i,s,r){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return s;try{if(this.repeated){var n;if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){s.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),s.ensureCapacity(s.offset+=1);var o=s.offset;for(n=0;n<i.length;n++)this.element.encodeValue(this.id,i[n],s);var a=s.offset-o,h=e.calculateVarint32(a);if(h>1){var l=s.slice(o,s.offset);o+=h-1,s.offset=o,s.append(l)}s.writeVarint32(a,o-h)}else for(n=0;n<i.length;n++)s.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i[n],s)}else this.map?i.forEach(function(i,r,n){var o=e.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+e.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i);s.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),s.writeVarint32(o),s.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,r,s),s.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,i,s)},this):this.hasWirePresence(i,r)&&(s.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i,s))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+e+")")}return s},p.calculate=function(i,s){if(i=this.verifyValue(i),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return 0;var r=0;try{if(this.repeated){var n,o;if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(r+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),o=0,n=0;n<i.length;n++)o+=this.element.calculateLength(this.id,i[n]);r+=e.calculateVarint32(o),r+=o}else for(n=0;n<i.length;n++)r+=e.calculateVarint32(this.id<<3|this.type.wireType),r+=this.element.calculateLength(this.id,i[n])}else this.map?i.forEach(function(i,s,n){var o=e.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,s)+e.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i);r+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),r+=e.calculateVarint32(o),r+=o},this):this.hasWirePresence(i,s)&&(r+=e.calculateVarint32(this.id<<3|this.type.wireType),r+=this.element.calculateLength(this.id,i))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+e+")")}return r},p.decode=function(e,i,s){var r,n;if(!(!this.map&&e==this.type.wireType||!s&&this.repeated&&this.options.packed&&e==t.WIRE_TYPES.LDELIM||this.map&&e==t.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!s){n=i.readVarint32(),n=i.offset+n;for(var o=[];i.offset<n;)o.push(this.decode(this.type.wireType,i,!0));return o}if(this.map){var a=f.defaultFieldValue(this.keyType);if(r=f.defaultFieldValue(this.type),n=i.readVarint32(),i.remaining()<n)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+n+" required but got only "+i.remaining());var h=i.clone();for(h.limit=h.offset+n,i.offset+=n;h.remaining()>0;){var l=h.readVarint32();e=7&l;var u=l>>>3;if(1===u)a=this.keyElement.decode(h,e,u);else{if(2!==u)throw Error("Unexpected tag in map field key/value submessage");r=this.element.decode(h,e,u)}}return[a,r]}return this.element.decode(i,e,this.id)},n.Message.Field=g;var m=function(e,t,i,s,r,n,o){g.call(this,e,t,i,null,s,r,n,o),this.extension};m.prototype=Object.create(g.prototype),n.Message.ExtensionField=m;var y=function(e,t,i){o.call(this,e,t,i),this.fields=[]};n.Message.OneOf=y;var v=function(e,t,i,s,r){h.call(this,e,t,i,s,r),this.className="Enum",this.object=null};v.getName=function(e,t){for(var i,s=Object.keys(e),r=0;r<s.length;++r)if(e[i=s[r]]===t)return i;return null},(v.prototype=Object.create(h.prototype)).build=function(e){if(this.object&&!e)return this.object;for(var i=new t.Builder.Enum,s=this.getChildren(v.Value),r=0,n=s.length;r<n;++r)i[s[r].name]=s[r].id;return Object.defineProperty&&Object.defineProperty(i,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=i},n.Enum=v;var b=function(e,t,i,s){o.call(this,e,t,i),this.className="Enum.Value",this.id=s};b.prototype=Object.create(o.prototype),n.Enum.Value=b;var w=function(e,t,i,s){o.call(this,e,t,i),this.field=s};w.prototype=Object.create(o.prototype),n.Extension=w;var E=function(e,t,i,s){h.call(this,e,t,i,s),this.className="Service",this.clazz=null};(E.prototype=Object.create(h.prototype)).build=function(i){return this.clazz&&!i?this.clazz:this.clazz=function(t,i){for(var s=function(e){t.Builder.Service.call(this),this.rpcImpl=e||function(e,t,i){setTimeout(i.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},r=s.prototype=Object.create(t.Builder.Service.prototype),n=i.getChildren(t.Reflect.Service.RPCMethod),o=0;o<n.length;o++)!function(t){r[t.name]=function(s,r){try{try{s=t.resolvedRequestType.clazz.decode(e.wrap(s))}catch(e){if(!(e instanceof TypeError))throw e}if(null===s||"object"!=typeof s)throw Error("Illegal arguments");s instanceof t.resolvedRequestType.clazz||(s=new t.resolvedRequestType.clazz(s)),this.rpcImpl(t.fqn(),s,function(e,s){if(e)return void r(e);null===s&&(s="");try{s=t.resolvedResponseType.clazz.decode(s)}catch(e){}if(!(s&&s instanceof t.resolvedResponseType.clazz))return void r(Error("Illegal response type received in service method "+i.name+"#"+t.name));r(null,s)})}catch(e){setTimeout(r.bind(this,e),0)}},s[t.name]=function(e,i,r){new s(e)[t.name](i,r)},Object.defineProperty&&(Object.defineProperty(s[t.name],"$options",{value:t.buildOpt()}),Object.defineProperty(r[t.name],"$options",{value:s[t.name].$options}))}(n[o]);return Object.defineProperty&&(Object.defineProperty(s,"$options",{value:i.buildOpt()}),Object.defineProperty(r,"$options",{value:s.$options}),Object.defineProperty(s,"$type",{value:i}),Object.defineProperty(r,"$type",{value:i})),s}(t,this)},n.Service=E;var T=function(e,t,i,s){o.call(this,e,t,i),this.className="Service.Method",this.options=s||{}};(T.prototype=Object.create(o.prototype)).buildOpt=l.buildOpt,n.Service.Method=T;var C=function(e,t,i,s,r,n,o,a){T.call(this,e,t,i,a),this.className="Service.RPCMethod",this.requestName=s,this.responseName=r,this.requestStream=n,this.responseStream=o,this.resolvedRequestType=null,this.resolvedResponseType=null};return C.prototype=Object.create(T.prototype),n.Service.RPCMethod=C,n}(i),i.Builder=function(e,t,i){function s(e){e.messages&&e.messages.forEach(function(t){t.syntax=e.syntax,s(t)}),e.enums&&e.enums.forEach(function(t){t.syntax=e.syntax})}var r=function(e){this.ns=new i.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},n=r.prototype;return r.isMessage=function(e){return"string"==typeof e.name&&(void 0===e.values&&void 0===e.rpc)},r.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},r.isEnum=function(e){return"string"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},r.isService=function(e){return!("string"!=typeof e.name||"object"!=typeof e.rpc||!e.rpc)},r.isExtend=function(e){return"string"==typeof e.ref},n.reset=function(){return this.ptr=this.ns,this},n.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach(function(e){
var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new i.Namespace(this,this.ptr,e)),this.ptr=t},this),this},n.create=function(t){if(!t)return this;if(Array.isArray(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(var s=[t];s.length>0;){if(t=s.pop(),!Array.isArray(t))throw Error("not a valid namespace: "+JSON.stringify(t));for(;t.length>0;){var n=t.shift();if(r.isMessage(n)){var o=new i.Message(this,this.ptr,n.name,n.options,n.isGroup,n.syntax),a={};n.oneofs&&Object.keys(n.oneofs).forEach(function(e){o.addChild(a[e]=new i.Message.OneOf(this,o,e))},this),n.fields&&n.fields.forEach(function(e){if(null!==o.getChild(0|e.id))throw Error("duplicate or invalid field id in "+o.name+": "+e.id);if(e.options&&"object"!=typeof e.options)throw Error("illegal field options in "+o.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=a[e.oneof]))throw Error("illegal oneof in "+o.name+"#"+e.name+": "+e.oneof);e=new i.Message.Field(this,o,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,n.syntax),t&&t.fields.push(e),o.addChild(e)},this);var h=[];if(n.enums&&n.enums.forEach(function(e){h.push(e)}),n.messages&&n.messages.forEach(function(e){h.push(e)}),n.services&&n.services.forEach(function(e){h.push(e)}),n.extensions&&("number"==typeof n.extensions[0]?o.extensions=[n.extensions]:o.extensions=n.extensions),this.ptr.addChild(o),h.length>0){s.push(t),t=h,h=null,this.ptr=o,o=null;continue}h=null}else if(r.isEnum(n))o=new i.Enum(this,this.ptr,n.name,n.options,n.syntax),n.values.forEach(function(e){o.addChild(new i.Enum.Value(this,o,e.name,e.id))},this),this.ptr.addChild(o);else if(r.isService(n))o=new i.Service(this,this.ptr,n.name,n.options),Object.keys(n.rpc).forEach(function(e){var t=n.rpc[e];o.addChild(new i.Service.RPCMethod(this,o,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))},this),this.ptr.addChild(o);else{if(!r.isExtend(n))throw Error("not a valid definition: "+JSON.stringify(n));if(o=this.ptr.resolve(n.ref,!0))n.fields.forEach(function(t){if(null!==o.getChild(0|t.id))throw Error("duplicate extended field id in "+o.name+": "+t.id);if(o.extensions){var s=!1;if(o.extensions.forEach(function(e){t.id>=e[0]&&t.id<=e[1]&&(s=!0)}),!s)throw Error("illegal extended field id in "+o.name+": "+t.id+" (not within valid ranges)")}var r=t.name;this.options.convertFieldsToCamelCase&&(r=e.Util.toCamelCase(r));var n=new i.Message.ExtensionField(this,o,t.rule,t.type,this.ptr.fqn()+"."+r,t.id,t.options),a=new i.Extension(this,this.ptr,t.name,n);n.extension=a,this.ptr.addChild(a),o.addChild(n)},this);else if(!/\.?google\.protobuf\./.test(n.ref))throw Error("extended message "+n.ref+" is not defined")}n=null,o=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},n.import=function(t,i){var r="/";if("string"==typeof i){if(e.Util.IS_NODE&&(i=require("path").resolve(i)),this.files[i]===!0)return this.reset();this.files[i]=!0}else if("object"==typeof i){var n=i.root;e.Util.IS_NODE&&(n=require("path").resolve(n)),(n.indexOf("\\")>=0||i.file.indexOf("\\")>=0)&&(r="\\");var o=n+r+i.file;if(this.files[o]===!0)return this.reset();this.files[o]=!0}if(t.imports&&t.imports.length>0){var a,h=!1;"object"==typeof i?(this.importRoot=i.root,h=!0,a=this.importRoot,i=i.file,(a.indexOf("\\")>=0||i.indexOf("\\")>=0)&&(r="\\")):"string"==typeof i?this.importRoot?a=this.importRoot:i.indexOf("/")>=0?""===(a=i.replace(/\/[^\/]*$/,""))&&(a="/"):i.indexOf("\\")>=0?(a=i.replace(/\\[^\\]*$/,""),r="\\"):a=".":a=null;for(var l=0;l<t.imports.length;l++)if("string"==typeof t.imports[l]){if(!a)throw Error("cannot determine import root");var f=t.imports[l];if("google/protobuf/descriptor.proto"===f)continue;if(f=a+r+f,this.files[f]===!0)continue;/\.proto$/i.test(f)&&!e.DotProto&&(f=f.replace(/\.proto$/,".json"));var u=e.Util.fetch(f);if(null===u)throw Error("failed to import '"+f+"' in '"+i+"': file not found");/\.json$/i.test(f)?this.import(JSON.parse(u+""),f):this.import(e.DotProto.Parser.parse(u),f)}else i?/\.(\w+)$/.test(i)?this.import(t.imports[l],i.replace(/^(.+)\.(\w+)$/,function(e,t,i){return t+"_import"+l+"."+i})):this.import(t.imports[l],i+"_import"+l):this.import(t.imports[l]);h&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&s(t);var c=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){c.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=c),t.enums&&(this.create(t.enums),this.ptr=c),t.services&&(this.create(t.services),this.ptr=c),t.extends&&this.create(t.extends),this.reset()},n.resolveAll=function(){var s;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof i.Namespace)this.ptr.children.forEach(function(e){this.ptr=e,this.resolveAll()},this);else if(this.ptr instanceof i.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(s=(this.ptr instanceof i.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=s,s instanceof i.Enum){if(this.ptr.type=e.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==s.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(s instanceof i.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=s.isGroup?e.TYPES.group:e.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=e.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((s=this.ptr.parent.resolve(this.ptr.requestName,!0))&&s instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=s,!((s=this.ptr.parent.resolve(this.ptr.responseName,!0))&&s instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=s}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension||this.ptr instanceof e.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},n.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(var t="string"==typeof e?e.split("."):e,i=this.result,s=0;s<t.length;s++){if(!i[t[s]]){i=null;break}i=i[t[s]]}return i},n.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},n.toString=function(){return"Builder"},r.Message=function(){},r.Enum=function(){},r.Service=function(){},r}(i,i.Lang,i.Reflect),i.Map=function(e,t){function i(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}var s=function(e,i){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new t.Element(e.keyType,null,!0,e.syntax),this.valueElem=new t.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),i)for(var s=Object.keys(i),r=0;r<s.length;r++){var n=this.keyElem.valueFromString(s[r]),o=this.valueElem.verifyValue(i[s[r]]);this.map[this.keyElem.valueToString(n)]={key:n,value:o}}},r=s.prototype;return r.clear=function(){this.map={}},r.delete=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e)),i=t in this.map;return delete this.map[t],i},r.entries=function(){for(var e,t=[],s=Object.keys(this.map),r=0;r<s.length;r++)t.push([(e=this.map[s[r]]).key,e.value]);return i(t)},r.keys=function(){for(var e=[],t=Object.keys(this.map),s=0;s<t.length;s++)e.push(this.map[t[s]].key);return i(e)},r.values=function(){for(var e=[],t=Object.keys(this.map),s=0;s<t.length;s++)e.push(this.map[t[s]].value);return i(e)},r.forEach=function(e,t){for(var i,s=Object.keys(this.map),r=0;r<s.length;r++)e.call(t,(i=this.map[s[r]]).value,i.key,this)},r.set=function(e,t){var i=this.keyElem.verifyValue(e),s=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(i)]={key:i,value:s},this},r.get=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e));if(t in this.map)return this.map[t].value},r.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},s}(0,i.Reflect),i.loadProto=function(e,t,s){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(s=t,t=void 0),i.loadJson(i.DotProto.Parser.parse(e),t,s)},i.protoFromString=i.loadProto,i.loadProtoFile=function(e,t,s){if(t&&"object"==typeof t?(s=t,t=null):t&&"function"==typeof t||(t=null),t)return i.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(r){if(null===r)return void t(Error("Failed to fetch file"));try{t(null,i.loadProto(r,s,e))}catch(e){t(e)}});var r=i.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===r?null:i.loadProto(r,s,e)},i.protoFromFile=i.loadProtoFile,i.newBuilder=function(e){return e=e||{},void 0===e.convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=i.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=i.populateAccessors),new i.Builder(e)},i.loadJson=function(e,t,s){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(s=t,t=null),t&&"object"==typeof t||(t=i.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,s),t.resolveAll(),t},i.loadJsonFile=function(e,t,s){if(t&&"object"==typeof t?(s=t,t=null):t&&"function"==typeof t||(t=null),t)return i.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(r){if(null===r)return void t(Error("Failed to fetch file"));try{t(null,i.loadJson(JSON.parse(r),s,e))}catch(e){t(e)}});var r=i.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===r?null:i.loadJson(JSON.parse(r),s,e)},i}),"undefined"==typeof Paho&&(Paho={}),Paho.MQTT=function(e){function t(e,t){var i=t,s=e[t],n=s>>4,o=s&=15;t+=1;var a,f=0,u=1;do{if(t==e.length)return[null,i];a=e[t++],f+=(127&a)*u,u*=128}while(0!=(128&a));var c=t+f;if(c>e.length)return[null,i];var d=new y(n);switch(ChatWebsocket.settings.onlineDebug&&console.log("decodeType:"+n+" "+new Date+" "+(new Date).getTime()),n){case l.CONNACK:1&e[t++]&&(d.sessionPresent=!0),d.returnCode=e[t++];break;case l.PUBLISH:var g=o>>1&3,p=r(e,t);t+=2;var m=h(e,t,p);t+=p,g>0&&(d.messageIdentifier=r(e,t),t+=2);var v=new Paho.MQTT.Message(e.subarray(t,c));1==(1&o)&&(v.retained=!0),8==(8&o)&&(v.duplicate=!0),v.qos=g,v.destinationName=m,d.payloadMessage=v;break;case l.PUBACK:case l.PUBREC:case l.PUBREL:case l.PUBCOMP:case l.UNSUBACK:d.messageIdentifier=r(e,t);break;case l.SUBACK:d.messageIdentifier=r(e,t),t+=2,d.returnCode=e.subarray(t,c)}return[d,c]}function i(e,t,i){return t[i++]=e>>8,t[i++]=e%256,i}function s(e,t,s,r){return r=i(t,s,r),a(e,s,r),r+t}function r(e,t){return 256*e[t]+e[t+1]}function n(e){var t=new Array(1),i=0;do{var s=e%128;e>>=7,e>0&&(s|=128),t[i++]=s}while(e>0&&i<4);return t}function o(e){for(var t=0,i=0;i<e.length;i++){var s=e.charCodeAt(i);s>2047?(55296<=s&&s<=56319&&(i++,t++),t+=3):s>127?t+=2:t++}return t}function a(e,t,i){for(var s=i,r=0;r<e.length;r++){var n=e.charCodeAt(r);if(55296<=n&&n<=56319){var o=e.charCodeAt(++r);if(isNaN(o))throw new Error(g(c.MALFORMED_UNICODE,[n,o]));n=o-56320+(n-55296<<10)+65536}n<=127?t[s++]=n:n<=2047?(t[s++]=n>>6&31|192,t[s++]=63&n|128):n<=65535?(t[s++]=n>>12&15|224,t[s++]=n>>6&63|128,t[s++]=63&n|128):(t[s++]=n>>18&7|240,t[s++]=n>>12&63|128,t[s++]=n>>6&63|128,t[s++]=63&n|128)}return t}function h(e,t,i){for(var s,r="",n=t;n<t+i;){var o=e[n++];if(o<128)s=o;else{var a=e[n++]-128;if(a<0)throw new Error(g(c.MALFORMED_UTF,[o.toString(16),a.toString(16),""]));if(o<224)s=64*(o-192)+a;else{var h=e[n++]-128;if(h<0)throw new Error(g(c.MALFORMED_UTF,[o.toString(16),a.toString(16),h.toString(16)]));if(o<240)s=4096*(o-224)+64*a+h;else{var l=e[n++]-128;if(l<0)throw new Error(g(c.MALFORMED_UTF,[o.toString(16),a.toString(16),h.toString(16),l.toString(16)]));if(!(o<248))throw new Error(g(c.MALFORMED_UTF,[o.toString(16),a.toString(16),h.toString(16),l.toString(16)]));s=262144*(o-240)+4096*a+64*h+l}}}s>65535&&(s-=65536,r+=String.fromCharCode(55296+(s>>10)),s=56320+(1023&s)),r+=String.fromCharCode(s)}return r}var l={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},f=function(e,t){for(var i in e)if(e.hasOwnProperty(i)){if(!t.hasOwnProperty(i)){var s="Unknown property, "+i+". Valid properties are:";for(var i in t)t.hasOwnProperty(i)&&(s=s+" "+i);throw new Error(s)}if(typeof e[i]!==t[i])throw new Error(g(c.INVALID_TYPE,[typeof e[i],i]))}},u=function(e,t){return function(){return e.apply(t,arguments)}},c={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},d={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},g=function(e,t){var i=e.text;if(t)for(var s,r,n=0;n<t.length;n++)if(s="{"+n+"}",(r=i.indexOf(s))>0){var o=i.substring(0,r),a=i.substring(r+s.length);i=o+t[n]+a}return i},p=[0,6,77,81,73,115,100,112,3],m=[0,4,77,81,84,84,4],y=function(e,t){this.type=e;for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])};y.prototype.encode=function(){var e=(15&this.type)<<4,t=0,r=new Array,a=0;switch(void 0!=this.messageIdentifier&&(t+=2),this.type){case l.CONNECT:switch(this.mqttVersion){case 3:t+=p.length+3;break;case 4:t+=m.length+3}if(t+=o(this.clientId)+2,void 0!=this.willMessage){t+=o(this.willMessage.destinationName)+2;var h=this.willMessage.payloadBytes;h instanceof Uint8Array||(h=new Uint8Array(u)),t+=h.byteLength+2}void 0!=this.userName&&(t+=o(this.userName)+2),void 0!=this.password&&(t+=o(this.password)+2);break;case l.SUBSCRIBE:e|=2;for(var f=0;f<this.topics.length;f++)r[f]=o(this.topics[f]),t+=r[f]+2;t+=this.requestedQos.length;break;case l.UNSUBSCRIBE:e|=2;for(var f=0;f<this.topics.length;f++)r[f]=o(this.topics[f]),t+=r[f]+2;break;case l.PUBREL:e|=2;break;case l.PUBLISH:this.payloadMessage.duplicate&&(e|=8),e=e|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(e|=1),a=o(this.payloadMessage.destinationName),t+=a+2;var u=this.payloadMessage.payloadBytes;t+=u.byteLength,u instanceof ArrayBuffer?u=new Uint8Array(u):u instanceof Uint8Array||(u=new Uint8Array(u.buffer));break;case l.DISCONNECT:}var c=n(t),d=c.length+1,g=new ArrayBuffer(t+d),y=new Uint8Array(g);if(y[0]=e,y.set(c,1),this.type==l.PUBLISH)d=s(this.payloadMessage.destinationName,a,y,d);else if(this.type==l.CONNECT){switch(this.mqttVersion){case 3:y.set(p,d),d+=p.length;break;case 4:y.set(m,d),d+=m.length}var v=0;this.cleanSession&&(v=2),void 0!=this.willMessage&&(v|=4,v|=this.willMessage.qos<<3,this.willMessage.retained&&(v|=32)),void 0!=this.userName&&(v|=128),void 0!=this.password&&(v|=64),y[d++]=v,d=i(this.keepAliveInterval,y,d)}switch(void 0!=this.messageIdentifier&&(d=i(this.messageIdentifier,y,d)),this.type){case l.CONNECT:d=s(this.clientId,o(this.clientId),y,d),void 0!=this.willMessage&&(d=s(this.willMessage.destinationName,o(this.willMessage.destinationName),y,d),d=i(h.byteLength,y,d),y.set(h,d),d+=h.byteLength),void 0!=this.userName&&(d=s(this.userName,o(this.userName),y,d)),void 0!=this.password&&(d=s(this.password,o(this.password),y,d));break;case l.PUBLISH:y.set(u,d);break;case l.SUBSCRIBE:for(var f=0;f<this.topics.length;f++)d=s(this.topics[f],r[f],y,d),y[d++]=this.requestedQos[f];break;case l.UNSUBSCRIBE:for(var f=0;f<this.topics.length;f++)d=s(this.topics[f],r[f],y,d)}return g};var v=function(e,t,i){this._client=e,this._window=t,this._keepAliveInterval=1e3*i,this.isReset=!1;var s=new y(l.PINGREQ).encode(),r=function(e){return function(){return n.apply(e)}},n=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(s),this.timeout=this._window.setTimeout(r(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(c.PING_TIMEOUT.code,g(c.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(r(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},b=function(e,t,i,s,r){this._window=t,i||(i=30);this.timeout=setTimeout(function(e,t,i){return function(){return e.apply(t,i)}}(s,e,r),1e3*i),this.cancel=function(){this._window.clearTimeout(this.timeout)}},w=function(t,i,s,r,n){if(!("WebSocket"in e&&null!==e.WebSocket))throw new Error(g(c.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in e&&null!==e.localStorage))throw new Error(g(c.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in e&&null!==e.ArrayBuffer))throw new Error(g(c.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",t,i,s,r,n),this.host=i,this.port=s,this.path=r,this.uri=t,this.clientId=n,this._localKey=i+":"+s+("/mqtt"!=r?":"+r:"")+":"+n+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0;for(var o in localStorage)0!=o.indexOf("Sent:"+this._localKey)&&0!=o.indexOf("Received:"+this._localKey)||this.restore(o)};w.prototype.host,w.prototype.port,w.prototype.path,w.prototype.uri,w.prototype.clientId,w.prototype.socket,w.prototype.connected=!1,w.prototype.maxMessageIdentifier=65536,w.prototype.connectOptions,w.prototype.hostIndex,w.prototype.onConnectionLost,w.prototype.onMessageDelivered,w.prototype.onMessageArrived,w.prototype.traceFunction,w.prototype._msg_queue=null,w.prototype._connectTimeout,w.prototype.sendPinger=null,w.prototype.receivePinger=null,w.prototype.receiveBuffer=null,w.prototype._traceBuffer=null,w.prototype._MAX_TRACE_ENTRIES=100,w.prototype.connect=function(e){var t=this._traceMask(e,"password");this._trace("Client.connect",t,this.socket,this.connected),this.connectOptions=e,e.uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},w.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw new Error(g(c.INVALID_STATE,["not connected"]));var i=new y(l.SUBSCRIBE);i.topics=[e],void 0!=t.qos?i.requestedQos=[t.qos]:i.requestedQos=[0],t.onSuccess&&(i.onSuccess=function(e){t.onSuccess({invocationContext:t.invocationContext,grantedQos:e})}),t.onFailure&&(i.onFailure=function(e){t.onFailure({invocationContext:t.invocationContext,errorCode:e})}),t.timeout&&(i.timeOut=new b(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:c.SUBSCRIBE_TIMEOUT.code,errorMessage:g(c.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},w.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw new Error(g(c.INVALID_STATE,["not connected"]));var i=new y(l.UNSUBSCRIBE);i.topics=[e],t.onSuccess&&(i.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(i.timeOut=new b(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:c.UNSUBSCRIBE_TIMEOUT.code,errorMessage:g(c.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},w.prototype.send=function(e){if(this._trace("Client.send",e),!this.connected)throw new Error(g(c.INVALID_STATE,["not connected"]));wireMessage=new y(l.PUBLISH),wireMessage.payloadMessage=e,e.qos>0?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},w.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw new Error(g(c.INVALID_STATE,["not connecting or connected"]));wireMessage=new y(l.DISCONNECT),this._notify_msg_sent[wireMessage]=u(this._disconnected,this),this._schedule_message(wireMessage)},w.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var e in this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},w.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,"@VERSION@")},w.prototype.stopTrace=function(){delete this._traceBuffer},w.prototype._doConnect=function(e){if(this.connectOptions.useSSL){var t=e.split(":");t[0]="wss",e=t.join(":")}this.connected=!1,this.connectOptions.mqttVersion,this.socket=new WebSocket(e),this.socket.binaryType="arraybuffer",this.socket.onopen=u(this._on_socket_open,this),this.socket.onmessage=u(this._on_socket_message,this),this.socket.onerror=u(this._on_socket_error,this),this.socket.onclose=u(this._on_socket_close,this),this.sendPinger=new v(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new v(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new b(this,window,this.connectOptions.timeout,this._disconnected,[c.CONNECT_TIMEOUT.code,g(c.CONNECT_TIMEOUT)])},w.prototype._schedule_message=function(e){this._msg_queue.push(e),this.connected&&this._process_queue()},w.prototype.store=function(e,t){var i={type:t.type,messageIdentifier:t.messageIdentifier,version:1};switch(t.type){case l.PUBLISH:t.pubRecReceived&&(i.pubRecReceived=!0),i.payloadMessage={};for(var s="",r=t.payloadMessage.payloadBytes,n=0;n<r.length;n++)r[n]<=15?s=s+"0"+r[n].toString(16):s+=r[n].toString(16);i.payloadMessage.payloadHex=s,i.payloadMessage.qos=t.payloadMessage.qos,i.payloadMessage.destinationName=t.payloadMessage.destinationName,t.payloadMessage.duplicate&&(i.payloadMessage.duplicate=!0),t.payloadMessage.retained&&(i.payloadMessage.retained=!0),0==e.indexOf("Sent:")&&(void 0===t.sequence&&(t.sequence=++this._sequence),i.sequence=t.sequence);break;default:throw Error(g(c.INVALID_STORED_DATA,[key,i]))}localStorage.setItem(e+this._localKey+t.messageIdentifier,JSON.stringify(i))},w.prototype.restore=function(e){var t=localStorage.getItem(e),i=JSON.parse(t),s=new y(i.type,i);switch(i.type){case l.PUBLISH:for(var r=i.payloadMessage.payloadHex,n=new ArrayBuffer(r.length/2),o=new Uint8Array(n),a=0;r.length>=2;){var h=parseInt(r.substring(0,2),16);r=r.substring(2,r.length),o[a++]=h}var f=new Paho.MQTT.Message(o);f.qos=i.payloadMessage.qos,f.destinationName=i.payloadMessage.destinationName,i.payloadMessage.duplicate&&(f.duplicate=!0),i.payloadMessage.retained&&(f.retained=!0),s.payloadMessage=f;break;default:throw Error(g(c.INVALID_STORED_DATA,[e,t]))}0==e.indexOf("Sent:"+this._localKey)?(s.payloadMessage.duplicate=!0,this._sentMessages[s.messageIdentifier]=s):0==e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[s.messageIdentifier]=s)},w.prototype._process_queue=function(){for(var e=null,t=this._msg_queue.reverse();e=t.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},w.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,e.type===l.PUBLISH&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},w.prototype._on_socket_open=function(){var e=new y(l.CONNECT,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},w.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data),this.receivePinger.reset();for(var t=this._deframeMessages(e.data),i=0;i<t.length;i+=1)this._handleMessage(t[i])},w.prototype._deframeMessages=function(e){var i=new Uint8Array(e);if(this.receiveBuffer){var s=new Uint8Array(this.receiveBuffer.length+i.length);s.set(this.receiveBuffer),s.set(i,this.receiveBuffer.length),i=s,delete this.receiveBuffer}try{for(var r=0,n=[];r<i.length;){var o=t(i,r),a=o[0];if(r=o[1],null===a)break;n.push(a)}r<i.length&&(this.receiveBuffer=i.subarray(r))}catch(e){return void this._disconnected(c.INTERNAL_ERROR.code,g(c.INTERNAL_ERROR,[e.message,e.stack.toString()]))}return n},w.prototype._handleMessage=function(e){this._trace("Client._handleMessage",e);try{switch(e.type){case l.CONNACK:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var t in this._sentMessages){var i=this._sentMessages[t];localStorage.removeItem("Sent:"+this._localKey+i.messageIdentifier)}this._sentMessages={};for(var t in this._receivedMessages){var s=this._receivedMessages[t];localStorage.removeItem("Received:"+this._localKey+s.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode){this._disconnected(c.CONNACK_RETURNCODE.code,g(c.CONNACK_RETURNCODE,[e.returnCode,d[e.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var r=new Array;for(var n in this._sentMessages)this._sentMessages.hasOwnProperty(n)&&r.push(this._sentMessages[n]);for(var r=r.sort(function(e,t){return e.sequence-t.sequence}),o=0,a=r.length;o<a;o++){var i=r[o];if(i.type==l.PUBLISH&&i.pubRecReceived){var h=new y(l.PUBREL,{messageIdentifier:i.messageIdentifier});this._schedule_message(h)}else this._schedule_message(i)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case l.PUBLISH:this._receivePublish(e);break;case l.PUBACK:var i=this._sentMessages[e.messageIdentifier];i&&(delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage));break;case l.PUBREC:var i=this._sentMessages[e.messageIdentifier];if(i){i.pubRecReceived=!0;var h=new y(l.PUBREL,{messageIdentifier:e.messageIdentifier});this.store("Sent:",i),this._schedule_message(h)}break;case l.PUBREL:var s=this._receivedMessages[e.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+e.messageIdentifier),s&&(this._receiveMessage(s),delete this._receivedMessages[e.messageIdentifier]);var f=new y(l.PUBCOMP,{messageIdentifier:e.messageIdentifier});this._schedule_message(f);break;case l.PUBCOMP:var i=this._sentMessages[e.messageIdentifier];delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage);break;case l.SUBACK:var i=this._sentMessages[e.messageIdentifier];i&&(i.timeOut&&i.timeOut.cancel(),128===e.returnCode[0]?i.onFailure&&i.onFailure(e.returnCode):i.onSuccess&&i.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case l.UNSUBACK:var i=this._sentMessages[e.messageIdentifier];i&&(i.timeOut&&i.timeOut.cancel(),i.callback&&i.callback(),delete this._sentMessages[e.messageIdentifier]);break;case l.PINGRESP:this.sendPinger.reset();break;case l.DISCONNECT:this._disconnected(c.INVALID_MQTT_MESSAGE_TYPE.code,g(c.INVALID_MQTT_MESSAGE_TYPE,[e.type]));break;default:this._disconnected(c.INVALID_MQTT_MESSAGE_TYPE.code,g(c.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}}catch(e){return void this._disconnected(c.INTERNAL_ERROR.code,g(c.INTERNAL_ERROR,[e.message,e.stack.toString()]))}},w.prototype._on_socket_error=function(e){this._disconnected(c.SOCKET_ERROR.code,g(c.SOCKET_ERROR,[e.data]))},w.prototype._on_socket_close=function(){this._disconnected(c.SOCKET_CLOSE.code,g(c.SOCKET_CLOSE))},w.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),ChatWebsocket.settings.onlineDebug&&console.log("sendType:"+e.type+" "+new Date+" "+(new Date).getTime()),this.sendPinger.reset()},w.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new y(l.PUBACK,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);var i=new y(l.PUBREC,{messageIdentifier:e.messageIdentifier});this._schedule_message(i);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},w.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},w.prototype._disconnected=function(e,t){this._trace("Client._disconnected",e,t),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===e&&(e=c.OK.code,t=g(c.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t})):4===this.connectOptions.mqttVersion&&this.connectOptions.mqttVersionExplicit===!1?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t}))},w.prototype._trace=function(){if(this.traceFunction){for(var e in arguments)void 0!==arguments[e]&&(arguments[e]=JSON.stringify(arguments[e]));var t=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:t})}if(null!==this._traceBuffer)for(var e=0,i=arguments.length;e<i;e++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===e?this._traceBuffer.push(arguments[e]):void 0===arguments[e]?this._traceBuffer.push(arguments[e]):this._traceBuffer.push("  "+JSON.stringify(arguments[e]))},w.prototype._traceMask=function(e,t){var i={}
;for(var s in e)e.hasOwnProperty(s)&&(i[s]=s==t?"******":e[s]);return i};var E=function(e,t,i,s){var r;if("string"!=typeof e)throw new Error(g(c.INVALID_TYPE,[typeof e,"host"]));if(2==arguments.length){s=t,r=e;var n=r.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!n)throw new Error(g(c.INVALID_ARGUMENT,[e,"host"]));e=n[4]||n[2],t=parseInt(n[7]),i=n[8]}else{if(3==arguments.length&&(s=i,i="/mqtt"),"number"!=typeof t||t<0)throw new Error(g(c.INVALID_TYPE,[typeof t,"port"]));if("string"!=typeof i)throw new Error(g(c.INVALID_TYPE,[typeof i,"path"]));var o=e.indexOf(":")!=-1&&"["!=e.slice(0,1)&&"]"!=e.slice(-1);r="ws://"+(o?"["+e+"]":e)+":"+t+i}for(var a=0,h=0;h<s.length;h++){var l=s.charCodeAt(h);55296<=l&&l<=56319&&h++,a++}if("string"!=typeof s||a>65535)throw new Error(g(c.INVALID_ARGUMENT,[s,"clientId"]));var u=new w(r,e,t,i,s);this._getHost=function(){return e},this._setHost=function(){throw new Error(g(c.UNSUPPORTED_OPERATION))},this._getPort=function(){return t},this._setPort=function(){throw new Error(g(c.UNSUPPORTED_OPERATION))},this._getPath=function(){return i},this._setPath=function(){throw new Error(g(c.UNSUPPORTED_OPERATION))},this._getURI=function(){return r},this._setURI=function(){throw new Error(g(c.UNSUPPORTED_OPERATION))},this._getClientId=function(){return u.clientId},this._setClientId=function(){throw new Error(g(c.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return u.onConnectionLost},this._setOnConnectionLost=function(e){if("function"!=typeof e)throw new Error(g(c.INVALID_TYPE,[typeof e,"onConnectionLost"]));u.onConnectionLost=e},this._getOnMessageDelivered=function(){return u.onMessageDelivered},this._setOnMessageDelivered=function(e){if("function"!=typeof e)throw new Error(g(c.INVALID_TYPE,[typeof e,"onMessageDelivered"]));u.onMessageDelivered=e},this._getOnMessageArrived=function(){return u.onMessageArrived},this._setOnMessageArrived=function(e){if("function"!=typeof e)throw new Error(g(c.INVALID_TYPE,[typeof e,"onMessageArrived"]));u.onMessageArrived=e},this._getTrace=function(){return u.traceFunction},this._setTrace=function(e){if("function"!=typeof e)throw new Error(g(c.INVALID_TYPE,[typeof e,"onTrace"]));u.traceFunction=e},this.connect=function(e){if(e=e||{},f(e,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),e.mqttVersion>4||e.mqttVersion<3)throw new Error(g(c.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0===e.password&&void 0!==e.userName)throw new Error(g(c.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(e.willMessage){if(!(e.willMessage instanceof T))throw new Error(g(c.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload,void 0===e.willMessage.destinationName)throw new Error(g(c.INVALID_TYPE,[typeof e.willMessage.destinationName,"connectOptions.willMessage.destinationName"]))}if(void 0===e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw new Error(g(c.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length<1)throw new Error(g(c.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,s=0;s<e.hosts.length;s++){if("string"!=typeof e.hosts[s])throw new Error(g(c.INVALID_TYPE,[typeof e.hosts[s],"connectOptions.hosts["+s+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[s])){if(0==s)t=!0;else if(!t)throw new Error(g(c.INVALID_ARGUMENT,[e.hosts[s],"connectOptions.hosts["+s+"]"]))}else if(t)throw new Error(g(c.INVALID_ARGUMENT,[e.hosts[s],"connectOptions.hosts["+s+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw new Error(g(c.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw new Error(g(c.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!=e.ports.length)throw new Error(g(c.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));e.uris=[];for(var s=0;s<e.hosts.length;s++){if("number"!=typeof e.ports[s]||e.ports[s]<0)throw new Error(g(c.INVALID_TYPE,[typeof e.ports[s],"connectOptions.ports["+s+"]"]));var n=e.hosts[s],o=e.ports[s],a=n.indexOf(":")!=-1;r="ws://"+(a?"["+n+"]":n)+":"+o+i,e.uris.push(r)}}}u.connect(e)},this.subscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},f(t,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if(void 0!==t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(g(c.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));u.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},f(t,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");u.unsubscribe(e,t)},this.send=function(e,t,i,s){var r;if(0==arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof T)&&"string"!=typeof e)throw new Error("Invalid argument:"+typeof e);if(r=e,void 0===r.destinationName)throw new Error(g(c.INVALID_ARGUMENT,[r.destinationName,"Message.destinationName"]));u.send(r)}else r=new T(t),r.destinationName=e,arguments.length>=3&&(r.qos=i),arguments.length>=4&&(r.retained=s),u.send(r)},this.disconnect=function(){u.disconnect()},this.getTraceLog=function(){return u.getTraceLog()},this.startTrace=function(){u.startTrace()},this.stopTrace=function(){u.stopTrace()},this.isConnected=function(){return u.connected}};E.prototype={get host(){return this._getHost()},set host(e){this._setHost(e)},get port(){return this._getPort()},set port(e){this._setPort(e)},get path(){return this._getPath()},set path(e){this._setPath(e)},get clientId(){return this._getClientId()},set clientId(e){this._setClientId(e)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(e){this._setOnConnectionLost(e)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(e){this._setOnMessageDelivered(e)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(e){this._setOnMessageArrived(e)},get trace(){return this._getTrace()},set trace(e){this._setTrace(e)}};var T=function(e){var t;if(!("string"==typeof e||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array))throw g(c.INVALID_ARGUMENT,[e,"newPayload"]);t=e,this._getPayloadString=function(){return"string"==typeof t?t:h(t,0,t.length)},this._getPayloadBytes=function(){if("string"==typeof t){var e=new ArrayBuffer(o(t)),i=new Uint8Array(e);return a(t,i,0),i}return t};var i=void 0;this._getDestinationName=function(){return i},this._setDestinationName=function(e){if("string"!=typeof e)throw new Error(g(c.INVALID_ARGUMENT,[e,"newDestinationName"]));i=e};var s=0;this._getQos=function(){return s},this._setQos=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);s=e};var r=!1;this._getRetained=function(){return r},this._setRetained=function(e){if("boolean"!=typeof e)throw new Error(g(c.INVALID_ARGUMENT,[e,"newRetained"]));r=e};var n=!1;this._getDuplicate=function(){return n},this._setDuplicate=function(e){n=e}};return T.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(e){this._setDestinationName(e)},get qos(){return this._getQos()},set qos(e){this._setQos(e)},get retained(){return this._getRetained()},set retained(e){this._setRetained(e)},get duplicate(){return this._getDuplicate()},set duplicate(e){this._setDuplicate(e)}},{Client:E,Message:T}}(window);var Proto=ProtobufMessage.prototype;Proto.init=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");var e=dcodeIO.ProtoBuf;Proto.chatProto=e.loadProtoFile(INTERFACE_URLS.chatProtoUrl),Proto.createMessage.init()},Proto.decode=function(e){return Proto.createMessage.build.chatProtocol.decode(e)},Proto.createMessage={init:function(){this.build={chatProtocol:Proto.chatProto.build("TechwolfChatProtocol"),message:Proto.chatProto.build("TechwolfMessage"),messageSync:Proto.chatProto.build("TechwolfMessage"),messageRead:Proto.chatProto.build("TechwolfMessageRead"),presence:Proto.chatProto.build("TechwolfPresence"),user:Proto.chatProto.build("TechwolfUser"),body:Proto.chatProto.build("TechwolfMessageBody"),clientInfo:Proto.chatProto.build("TechwolfClientInfo")}},model:{chatProtocol:function(e){var t=new Proto.createMessage.build.chatProtocol;return t.setType(e),t},message:function(e,t,i,s,r){var n=new Proto.createMessage.build.message;return n.setType(e),n.setMid(t,!0),n.setCmid(t,!0),n.setFrom(i),n.setTo(s),n.setBody(r),n},messageSync:function(e,t){var i=new Proto.createMessage.build.messageSync;return i.setClientMid(e,!0),i.setServerMid(t,!0),i},messageRead:function(e,t){var i=new Proto.createMessage.build.messageRead;return i.setUserId(e,!0),i.setMessageId(t,!0),i.setReadTime((new Date).getTime(),!0),i},presence:function(e){var t=new Proto.createMessage.build.presence,i=new Proto.createMessage.build.clientInfo,s=e.clientInfo;return t.setUid(_PAGE.uid,!0),t.setType(e.type),t.setLastMessageId(e.lastMessageId,!0),i.setVersion(s.version),i.setSystem(s.system),i.setSystemVersion(s.systemVersion),i.setModel(s.model),i.setUniqid(s.uniqid),i.setNetwork(s.network),i.setAppid(s.appid),i.setPlatform(s.platform),i.setChannel(s.channel),i.setSsid(s.ssid),i.setBssid(s.bssid),i.setLongitude(s.longitude),i.setLatitude(s.latitude),t.setClientInfo(i,!0),t},user:function(e,t){var i=new Proto.createMessage.build.user;return i.setUid(0,!0),e&&i.setName(t),i},body:function(e,t){var i=new Proto.createMessage.build.body;return i.setType(e),i.setTemplateId(t),i}},text:function(e){var t=this.model,i=t.user(),s=t.user(e.to.uid,e.to.encryptUid),r=t.body(1,1);r.setText(e.body.text);var n=t.message(1,e.tempID,i,s,r),o=t.chatProtocol(1);return o.setMessages([n]),o},sync:function(e){var t=this.model,i=t.messageSync(e.clientMid,e.serverMid),s=t.chatProtocol(5);return s.setMessageSync([i]),s},read:function(e){var t=this.model,i=t.messageRead(e.uid,e.mid),s=t.chatProtocol(6);return s.setMessageRead([i]),s},presence:function(e){var t=this.model,i=t.presence(e),s=t.chatProtocol(2);return s.setPresence(i),s}};var Emotion={data:["微笑","撇嘴","色","发呆","得意","流泪","害羞","闭嘴","睡","大哭","尴尬","发怒","调皮","呲牙","惊讶","难过","酷","冷汗","抓狂","吐","偷笑","愉快","白眼","傲慢","饥饿","困","惊恐","流汗","憨笑","悠闲","奋斗","咒骂","疑问","嘘","晕","疯了","衰","骷髅","敲打","再见","擦汗","抠鼻","鼓掌","糗大了","坏笑","左哼哼","右哼哼","哈欠","鄙视","委屈","快哭了","阴险","亲亲","吓","可怜","菜刀","西瓜","啤酒","篮球","乒乓","咖啡","饭","猪头","玫瑰","凋谢","嘴唇","爱心","心碎","蛋糕","闪电","炸弹","刀","足球","瓢虫","便便","月亮","太阳","礼物","拥抱","强","弱","握手","胜利","抱拳","勾引","拳头","差劲","爱你","NO","OK"],init:function(){var e,t,i="",s=Publisher.editor.find(".emotion");if(!s.length){for(e=0;e<Emotion.data.length;e++)t=Emotion.data[e],i+='<li><button class="emoj emoj-'+(e+1)+'" data-key="['+t+']" title="'+t+'"></button></li>';Publisher.editor.append('<div class="emotion"><ul>'+i+"</ul></div>"),Emotion.showEmotion(),$(document).on("click",function(e){$(e.target).hasClass("btn-emotion")||$(e.target).parents(".emotion").length||Emotion.hideEmotion()}),Publisher.editor.find(".emotion").on("click",".emoj",function(){var e=$(this);Emotion.chooseEmotion(e)})}s.show()},showEmotion:function(){Publisher.editor.find(".emotion").show()},hideEmotion:function(){Publisher.editor.find(".emotion").hide()},textCodeToImg:function(e){var t,i=e.match(/\[[a-zA-Z\u4e00-\u9fa5]{1,3}\]/g);if(!i)return e;for(t=0;t<i.length;t++){var s,r=i[t].replace(/[\[\]]/g,""),n=Emotion.data.indexOf(r);n>-1&&(s='<i class="emoj emoj-'+(n+1)+'" title="'+r+'"></i>'),s&&(e=e.replace(i[t],s))}return e},chooseEmotion:function(e){var t=e,i=t.attr("class").split("emoj-")[1];Publisher.editorInput.focus();var s="/v2/web/boss/images/emotions/Expression_"+i+"@2x.png";Publisher.editorInput.find("img:not(.emoj-insert)");Publisher.inserCurosrHtml(s,t.attr("data-key")),Emotion.hideEmotion(),Publisher.submitBtn.removeClass("btn-disabled")}},Publisher={init:function(){Publisher.editor=$(".chat-editor"),Publisher.editorControls=Publisher.editor.find(".chat-controls"),Publisher.editorInput=Publisher.editor.find(".chat-message"),Publisher.editorPlaceholder=Publisher.editor.find(".chat-placholder"),Publisher.submitBtn=Publisher.editor.find(".btn-send"),Publisher.menuWrap=$(".chat-container .data-menu"),_PAGE.runChat&&(Publisher.editor.find(".chat-op").removeAttr("ka"),Publisher.editorInput.removeAttr("ka")),Publisher.editorControls.on("click","a",function(){if(!$(this).parent().hasClass("links"))switch($(this).attr("class")){case"btn-emotion":Emotion.init();break;case"btn-dict":Publisher.showSentence($(this));break;case"btn-contact":$.confirm({content:"确认与对方交换电话吗？",title:"温馨提示",closeIcon:!0,columnClass:"",onOpen:function(){},confirm:function(){Chat.exchangePhone(2,{from:{uid:Chat.curUserData.uid}})},error:function(e){}});break;case"btn-weixin":$.confirm({content:"确认与对方交换微信吗？",title:"温馨提示",closeIcon:!0,columnClass:"",onOpen:function(){},confirm:function(){Chat.exchangeWeixin(2,{from:{uid:Chat.curUserData.uid}})},error:function(e){}});break;case"btn-resume":$.confirm({content:"向牛人索取简历吗？<p>如果牛人同意，TA的简历将发送到<br/>"+Chat.myselfData.email+"</p>",title:"温馨提示",closeIcon:!0,columnClass:"",onOpen:function(){},confirm:function(){Chat.exchangeResume(2,{from:{uid:Chat.curUserData.uid}})},error:function(e){}});break;case"btn-transmit":$.confirm({content:'<div class="transmit-con"><div class="transmit-title">把<span class="text-blue"></span>推荐给同事</div><div class="transmit-list"><ul></ul></div><div class="transmit-op"><p><textarea class="ipt ipt-area" name="shareNote">此人文武双全，你一定要看看啊！</textarea></p><p class="tip-text"><label class="checkbox"><input type="checkbox" name="canShareMsg" /><span>连同聊天记录一并转发</span></label></p></div></div>',title:!1,closeIcon:!0,columnClass:"pop-default",onOpen:function(){var e=this,t=e.$content.find(".transmit-list ul");e.$content.find(".transmit-title .text-blue").text(Chat.curUserData.name),$.ajax({type:"GET",url:"/chat/brandUserList.json",dataType:"JSON",data:{page:1,pageSize:100},success:function(e){var i,s,e=e,r="";if(1==e.rescode){for(i=e.data,s=0;s<i.length;s++)r+='<li data-uid="'+i[s].userId+'"><img src="'+i[s].tiny+'" /><span class="name">'+i[s].name+"</span></li>";t.append(r)}},error:function(e){}}),t.on("click","li",function(){var e=$(this);e.attr("data-uid");e.parent().find("li").removeClass("checked"),e.find(".fz-check").length||e.append('<i class="fz fz-check"></i>'),e.addClass("checked")})},confirm:function(){var e=this,t=e.$content.find(".transmit-list li.checked"),i=t.attr("data-uid"),s=e.$content.find('input[name="canShareMsg"]:checked'),r=s.length?1:0,n=e.$content.find('textarea[name="shareNote"]').val();return i?""==n?(0==e.$content.find(".transmit-con .tip-error").length?e.$content.find(".transmit-con").prepend('<div class="tip-error">请填写推荐评语</div>'):e.$content.find(".transmit-con .tip-error").html("请填写推荐评语"),!1):(e.$content.find(".transmit-con .tip-error").remove(),void $.ajax({type:"POST",url:"/chat/shareGeek.json",dataType:"JSON",data:{toId:i,geekId:Chat.curUserData.uid,shareNote:n,expectId:Chat.curUserData.jobId,canShareMsg:r},success:function(t){var t=t;1==t.rescode?($.confirm({content:"转发成功",title:"温馨提示",closeIcon:!0,columnClass:"",autoClose:"confirm|3000"}),e.close()):$.confirm({content:"转发失败",title:"温馨提示",closeIcon:!0,columnClass:"",autoClose:"confirm|3000"})},error:function(e){$.confirm({content:"发送失败",title:"温馨提示",closeIcon:!0,columnClass:"",autoClose:"confirm|3000"})}})):(0==e.$content.find(".transmit-con .tip-error").length?e.$content.find(".transmit-con").prepend('<div class="tip-error">请选择一位同事</div>'):e.$content.find(".transmit-con .tip-error").html("请选择一位同事"),!1)}});break;case"btn-interview":if(Chat.curUserData.isCloseInterview)return $.confirm({content:"请勿重复发送",title:"温馨提示",closeIcon:!0,columnClass:"",autoClose:"confirm|3000"}),!1;$.confirm({content:'<form class="form-check"><input type="hidden" name="_token" value=""><table class="data-manage"><tr><td class="t">职位：</td><td><select class="ipt sel" name="jobid"><option>请选择职位</option></select></td></tr><tr><td class="t">面试时间：</td><td><input type="text" class="ipt ipt-datetimepicker" name="date" data-type="y-m-d" data-format="yyyy-mm-dd" placeholder="选择日期" autocomplete="off"> - <select name="hour" class="sel"><option value="0">请选择</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option></select> : <select name="minute" class="sel"><option value="0">请选择</option><option value="0">00</option><option value="15">15</option><option value="30">30</option><option value="45">45</option></select></td></tr><tr><td class="t">面试地点：</td><td><p class="tip-text tip-address">请先选择职位</p></td></tr><tr><td class="t t-top">其他要求：</td><td><textarea name="other" class="ipt ipt-area" placeholder="选填，最多140字"></textarea></td></tr><tr><td class="t">&nbsp;</td><td><p class="tip-text"><label class="checkbox"><input type="checkbox" name="sendmsg" /><span></span></label>同时发送<span class="text-blue">面试邀请 </span>短信给<span class="name"></span>，消耗20积分</p></td></tr></table></form>',title:"邀请面试",closeIcon:!0,columnClass:"pop-default",onOpen:function(){if(Chat.jobData={},_self=this,$(".ipt-datetimepicker").length){var e=new Date;nowYear=e.getFullYear(),nowMonth=e.getMonth()+1,nowThisDate=e.getDate(),$(".ipt-datetimepicker").each(function(){var e=$(this).attr("data-format")||"yyyy-mm-dd",t=$(this).attr("data-type"),i=2,s=2;t&&"y-m-d"==t&&(i=2,s=2),t&&"h:i"==t&&(i=1,s=0),$(this).datetimepicker({format:e,startView:i,minView:s,autoclose:1,startDate:nowYear+"-"+nowMonth+"-"+nowThisDate,todayBtn:0})})}$.ajax({type:"GET",url:"/chat/user/joblist.json",dataType:"JSON",data:null,success:function(e){var t,e=e,i="";if(1==e.rescode){for(t=0;t<e.data.length;t++)i+='<option value="'+e.data[t].jobId+'">'+filterXss(e.data[t].jobName)+"</option>",Chat.jobData[e.data[t].jobId]||(Chat.jobData[e.data[t].jobId]={}),Chat.jobData[e.data[t].jobId].jobName=filterXss(e.data[t].jobName),Chat.jobData[e.data[t].jobId].address=filterXss(e.data[t].address),0==t&&_self.$content.find(".tip-address").html(filterXss(e.data[t].address));_self.$content.find('.sel[name="jobid"]').html(i)}},error:function(e){}}),_self.$content.find('.sel[name="jobid"]').on("change",function(){var e=$(this).val();_self.$content.find(".tip-address").html(Chat.jobData[e].address)}),_self.$content.find(".data-manage .tip-text .name").text(Chat.curUserData.name)},confirm:function(){var e=this,t=e.$content.find('.sel[name="jobid"]').val(),i=e.$content.find('input[name="date"]').val(),s=e.$content.find('.sel[name="hour"]').val(),r=e.$content.find('.sel[name="minute"]').val(),n=e.$content.find('textarea[name="other"]').val(),o=e.$content.find('input[name="sendmsg"]:checked').val();return""==t?(alert("请选择职位"),!1):""==i?(alert("请选择日期"),!1):"0"==s?(alert("请选择时段"),!1):n.length>140?(alert("其他要求字数最多为140字"),!1):($.ajax({type:"POST",url:"/bossweb/interview/invite.json",dataType:"JSON",data:{jobname:Chat.jobData[t].jobName,jobid:t,date:i,hour:s,minute:r,address:Chat.jobData[t].address,other:n,uid:Chat.curUserData.uid,name:Chat.curUserData.name,sendmsg:o?1:0},success:function(t){var t=t;1==t.rescode?(Chat.usersData[Chat.curUserData.uid].isCloseInterview=!0,e.close()):3==t.rescode?(Chat.usersData[Chat.curUserData.uid].isCloseInterview=!0,Chat.showSystemMessage(Chat.curUserData.uid,t.resmsg),Publisher.editorControls.find(".btn-interview").addClass("disabled"),e.close()):alert(t.resmsg)},error:function(e){}}),!1)},error:function(e){}})}});var e="按Enter键发送，按Ctrl+Enter键换行";isIE&&(e="按Enter键发送",Publisher.editor.find(".chat-op .tip").text(e)),Publisher.editorInput.on("keyup",function(e){var t=Publisher.htmlConverToMessage($(this).html());return""!=t.replace(/[\n\s]/g,"")?void Publisher.submitBtn.removeClass("btn-disabled"):void Publisher.submitBtn.addClass("btn-disabled")});try{document.execCommand("AutoUrlDetect",!1,!1)}catch(e){}Publisher.editorInput.on("paste",function(e){var t=null;if(t=window.clipboardData&&clipboardData.setData?window.clipboardData.getData("text"):(e.originalEvent||e).clipboardData.getData("text/plain"),document.body.createTextRange){if(document.selection)textRange=document.selection.createRange();else if(window.getSelection){var i=window.getSelection(),s=i.getRangeAt(0),r=document.createElement("span");r.innerHTML="&#FEFF;",s.deleteContents(),s.insertNode(r),textRange=document.body.createTextRange(),textRange.moveToElementText(r),r.parentNode.removeChild(r)}textRange.text=t,textRange.collapse(!1),textRange.select()}else document.execCommand("insertText",!1,t),""!=t&&Publisher.submitBtn.removeClass("btn-disabled");e.preventDefault()}),Publisher.editorInput.bind("keydown",function(e){13==e.which&&(e.ctrlKey||e.shiftKey?document.execCommand("insertText",!1,"\n"):(Publisher.sendText(),e.preventDefault())),""!=Publisher.editorInput.html()&&Publisher.editorPlaceholder.hide()}),Publisher.editorInput.bind("focus",function(e){Publisher.editorPlaceholder.hide()}),Publisher.editorInput.bind("blur",function(e){""!=Publisher.editorInput.html()&&"<br>"!=Publisher.editorInput.html()||Publisher.editorPlaceholder.show()}),Publisher.editorInput.on("click",function(){if(_PAGE.runChat)try{_T.sendEvent("Geekchat_input_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid)}catch(e){}}),Publisher.editorPlaceholder.on("click",function(){Publisher.editorPlaceholder.hide(),Publisher.editorInput.focus()}),Publisher.editorControls.on("click",function(e){$(e.target).closest("a").length||(Publisher.editorPlaceholder.hide(),Publisher.editorInput.focus())}),Publisher.editorControls.find("a").each(function(){var e=$(this).attr("ka"),t=e.split("_")[2];_PAGE.runChat&&$(this).data("optype",t).removeAttr("ka")}).on("click",function(){var e=$(this).data("optype");if(_PAGE.runChat)try{_T.sendEvent("Geekchat_"+e+"_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid)}catch(e){}}),Publisher.submitBtn.on("click",function(e){Publisher.sendText()}),$(document).on("click",function(e){$(e.target).hasClass("btn-dict")||$(e.target).parents(".sentence-pannel").length||Publisher.editor.find(".sentence-pannel").remove()})},htmlConverToMessage:function(e){var t=$("<div/>");return t.append(e),t.find("img").each(function(){$(this).replaceWith($(this).data("key"))}),t.text()},inserCurosrHtml:function(e,t){var i=Publisher.editorInput.get(0);Publisher.editorInput.text().length;if("getSelection"in window){var s=window.getSelection();if(s&&1===s.rangeCount){i.focus();var r=s.getRangeAt(0),n=new Image;n.src=e,n.setAttribute("data-key",t),n.className="emoj-insert",n.setAttribute("title",t.replace("[","").replace("]","")),r.deleteContents(),r.insertNode(n),r.collapse(!1),s.removeAllRanges(),s.addRange(r)}}else if("selection"in document){i.focus();var r=document.selection.createRange();r.pasteHTML('<img class="emoj-insert" data-key="'+t+'" title="'+t.replace("[","").replace("]","")+'" src="'+e+'">'),i.focus()}},sendText:function(e){var e=e,t="";if(e)t=e;else{if(Publisher.editorInput.hasClass("btn-disabled"))return!1;t=Publisher.htmlConverToMessage(Publisher.editorInput.html());try{_T.sendEvent("Geekchat_send_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid)}catch(e){}if(""==t.replace(/[\n\s]/g,""))return alert("请输入文字"),Publisher.editorInput.html(""),!1;if(t.length>1e3)return alert("您输入的内容过长，请删减后再发送"),!1}var i=(new Date).getTime();Chat.sendTextMessage({tempID:_PAGE.uid+i,isSelf:!0,from:{uid:Chat.myselfData.uid,name:Chat.myselfData.name,avatar:Chat.myselfData.face},to:{uid:Chat.curUserData.uid,encryptUid:Chat.curUserData.encryptUid},time:i,body:{type:1,text:t},mSource:"server",typeSource:"newSubmit"}),e||(Publisher.editorInput.html(""),Publisher.submitBtn.addClass("btn-disabled"),Publisher.editorPlaceholder.show())},showSentence:function(e){var t='<div class="sentence-pannel"><h3 class="title"><a href="javascript:;" class="link-set">设置</a>常用语</h3><div class="sentence-blank">加载中...</div></div>',s=Publisher.editorInput.get(0);$.ajax({url:"/setting/replyword/list.json",type:"GET",data:null,dataType:"JSON",timeout:3e4,success:function(e){var r="",n=e.replyWords;if(e.rescode){if(n.length){for(i=0;i<n.length;i++)r+="<li>"+filterXss(n[i])+"</li>";t='<div class="sentence-pannel"><h3 class="title"><a href="javascript:;" class="link-set">设置</a>常用语</h3><ul>'+r+"</ul></div>"}else t='<div class="sentence-pannel"><h3 class="title"><a href="javascript:;" class="link-set">设置</a>常用语</h3><div class="sentence-blank"><a href="javascript:;" class="link-add">+添加常用语</a></div></div>';$(t).appendTo(Publisher.editor).show(),Publisher.editor.find(".sentence-pannel li").on("click",function(){Publisher.editorInput.html(Publisher.editorInput.html()+$(this).text()),Publisher.editor.find(".sentence-pannel").hide(),Publisher.submitBtn.removeClass("btn-disabled"),Publisher.setCursorEnd(s)}),Publisher.editor.find(".sentence-pannel .link-set").on("click",function(){PageSet.showPannel(null,"1"),Menu.setUrl("set")})}},error:function(e){}})},setCursorEnd:function(e){if(window.getSelection){e.focus();var t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()}else if(document.selection){var t=document.selection.createRange();t.moveToElementText(e),t.collapse(!1),t.select()}}};noticeSwitch={init:function(){var e=this;window.noticeIsClose=!!localStorageInstance("noticeisclose")&&Boolean(localStorageInstance("noticeisclose")),window.noticeAudioIsClose=!!localStorageInstance("noticeaudioisclose")&&Boolean(localStorageInstance("noticeaudioisclose")),this.box=$(".aside_nav_bar .btool"),this.setBox=this.box.find(".setbox"),this.box.find(".btn_settings").bind("click",function(t){e.setBox.is(":hidden")?(e.setBox.show(),bindObjOutsiteClick(e.setBox)):(e.setBox.hide(),unbindObjOutsiteClick(e.setBox)),t.preventDefault()}),window.noticeIsClose&&this.setBox.find(".desk").addClass("off").text("打开桌面通知"),window.noticeAudioIsClose&&this.setBox.find(".audio").addClass("off").text("打开声音提醒"),this.setBox.find(".desk").bind("click",function(e){window.noticeIsClose?(window.noticeIsClose=!1,$(this).removeClass("off").text("关闭桌面通知")):(window.noticeIsClose=!0,$(this).addClass("off").text("打开桌面通知")),localStorageInstance("noticeisclose",window.noticeIsClose),e.preventDefault()}),this.setBox.find(".audio").bind("click",function(e){window.noticeAudioIsClose?(window.noticeAudioIsClose=!1,$(this).removeClass("off").text("关闭声音提醒")):(window.noticeAudioIsClose=!0,$(this).addClass("off").text("打开声音提醒")),localStorageInstance("noticeaudioisclose",window.noticeAudioIsClose),e.preventDefault()})}},$(function(){noticeSwitch.init()}),pageTitleStatus={status:null,ani:null,aniTime:500,set:function(e){var t=this,i="data:image/ico;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAC6wk3/usJN/7rCTf+6wk3/usFN/7nBS/+6wEz/usFL/7rAS/+5wU3/u8JP/7vBTf+6wk3/usJN/7rCTf+6wk3/u8JP/7vCT/+7wk//u8JP/7vDUP+8xFP/u8JR/7zCT/+8wlD/usFM/7e/Rf+8wk7/u8JP/7vCT/+7wk//u8JP/7rCTv+6wk7/u8JQ/7a+Q//S143/9/ju//f57v/6+vX/+fv1//Dy3v/R1Yz/usBK/7rCTv+6wk7/usJO/7rCTv+7w07/u8NO/7zEUf+2v0H/19uZ///////o6sX/3eGl/+Hksv/29+v//////9XZk/+4wEX/vMRQ/7vDTv+7w07/vcRP/73ET/++xVL/uMBD/9bblv//////y9B5/7K7Nv+4vkH/wshf//n68//z9eP/vcRR/73ETv+9xE//vcRP/7zET/+8xE//vcVS/7jAQ//X25b//////9DVhv+7wkr/vsZT/7rARf/t79X//Pz3/7/GVv+7w03/vcRQ/7zET/++xE//vsRP/7/FUv+6wUP/19uX///////P1IL/ucFE/7zDTf/N0nv//////+3w0v+9xE3/vsVQ/77FUP++xE//vsVQ/77FUP+/xlP/usFE/9jcmf//////9PXk/+/x2f/x8t7//P36//T15P/Kz3D/vMNK/7/GUv++xVD/vsVQ/77GUf++xlH/v8dU/7rCRf/Y3Zj///////T25P/v8dj/+Pnu//3+/f/T2Iz/usJE/7/HU/++xlH/vsZR/77GUf+/x1H/v8dR/8DIVP+7xET/2N2Y///////Q1oT/u8NG/8HHVf/s7cr//f79/8jOaf+9xkz/v8hS/7/HUf+/x1H/wMlQ/8DJUP/ByVP/u8VE/9nel///////0deE/77GSf+7w0H/0daE///////Y3Zj/u8VE/8HJU//AyVD/wMlQ/8DIU//AyFP/wclW/7zER//Z3Zf//////9LYhv+/xkr/xMpa/+frwf//////1dqQ/7zFSP/ByVb/wMhT/8DIU//ByVL/wclS/8HKVf+8xUb/3OCf///////8/Pf/+frz//39+///////7vDT/8LKV//AyVH/wclT/8HJUv/ByVL/wclT/8HJU//BylT/v8hN/87Udv/i5a7/4eWr/+Hlr//i5a3/2dyT/8TKVv/ByE//wcpU/8HJU//ByVP/wclT/8HKVP/BylT/wcpT/8LKVP/Ax03/vMVF/73FRf+9xUT/vcVE/7/HR//CyVP/wspU/8HKU//CylT/wcpU/8HKVP/Cy1P/wstT/8LLU//Cy1P/xcpV/8TMV//Fy1f/xMxW/8TLV//Ey1b/wspU/8PLU//Cy1P/wstT/8LLU//Cy1P/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==";if(faviconUrlNew="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAC6wk3/usJN/7rCTf+6wk3/usFN/7nBS/+6wEz/usFL/7rAS/+5wU3/u8JP/7vBTf+6wk3/usJN/7rCTf+6wk3/u8JP/7vCT/+7wk//u8JP/7vDUP+8xFP/u8JR/7zCT/+8wlD/usFM/7e/Rf+8wk7/u8JP/7vCT/+7wk//u8JP/7rCTv+6wk7/u8JQ/7a+Q//S143/9/ju//f57v/6+vX/+fv1//Dy3v/R1Yz/usBK/7rCTv+6wk7/usJO/7rCTv+7w07/u8NO/7zEUf+2v0H/19uZ///////o6sX/3eGl/+Hksv/29+v//////9XZk/+4wEX/vMRQ/7vDTv+7w07/vcRP/73ET/++xVL/uMBD/9bblv//////y9B5/7K7Nv+4vkH/wshf//n68//z9eP/vcRR/73ETv+9xE//vcRP/7zET/+8xE//vcVS/7jAQ//X25b//////9DVhv+7wkr/vsZT/7rARf/t79X//Pz3/7/GVv+7w03/vcRQ/7zET/++xE//vsRP/7/FUv+6wUP/19uX///////P1IL/ucFE/7zDTf/N0nv//////+3w0v+9xE3/vsVQ/77FUP++xE//vsVQ/77FUP+/xlP/usFE/9jcmf//////9PXk/+/x2f/x8t7//P36//T15P/Kz3D/vMNK/7/GUv++xVD/vsVQ/77GUf++xlH/v8dU/7rCRf/Y3Zj///////T25P/v8dj/+Pnu//3+/f/T2Iz/usJE/7/HU/++xlH/vsZR/77GUf+/x1H/v8dR/8DIVP+7xET/2N2Y///////Q1oT/u8NG/8HHVf/s7cr//f79/8jOaf+9xkz/v8hS/7/HUf+/x1H/wMlQ/8DJUP/ByVP/u8VE/9nel///////0deE/77GSf+7w0H/0daE///////Y3Zj/u8VE/8HJU//AyVD/wMlQ/8DIU//AyFP/wclW/7zER//Z3Zf//////9LYhv+/xkr/xMpa/+frwf//////vMGb/zI3w/8IDOn/MzjG/6mwZv/ByVL/wclS/8HKVf+8xUb/3OCf///////8/Pf/+frz//39+///////7vDT/zQ4x/8AA/D/AAPw/wAD8P8wNcj/wclT/8HJU//BylT/v8hN/87Udv/i5a7/4eWr/+Hlr//i5a3/2dyT/8TKVv8JDOj/AAPw/wAD8P8AA/D/BQjs/8HKVP/BylT/wcpT/8LKVP/Ax03/vMVF/73FRf+9xUT/vcVE/7/HR//CyVP/NDjG/wAD8P8AA/D/AAPw/zA1yf/Cy1P/wstT/8LLU//Cy1P/xcpV/8TMV//Fy1f/xMxW/8TLV//Ey1b/wspU/6yzZf80Ocb/CQzp/zQ5xv+rs2X/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==",isIE&&(i=_PAGE.assetUrl+"images/1.5/favicon.ico",faviconUrlNew=_PAGE.assetUrl+"images/1.5/favicon1.ico"),this.favicon||($("#favicon").length?this.favicon=$("#favicon"):this.favicon=$('<link rel="icon" id="favicon" type="image/x-icon">').attr("href",i).appendTo("html>head")),this.text="",e){if(this.text="("+e+")",document.title="BOSS直聘"+this.text,!this.ani){var s=!0;this.ani=setInterval(function(){t.favicon.attr("href",s?i:faviconUrlNew),s=!s},this.aniTime)}}else this.ani&&(clearInterval(this.ani),this.ani=null),t.favicon.attr("href",i),document.title="BOSS直聘"},clear:function(){this.status&&(this.status=null),this.ani&&clearInterval(this.ani)}},chatNotification={data:{},dataArray:[],dataHistory:[],show:function(e,t,i){if(!(_PAGE.debug&&this.num||(this.num=!0,window.noticeIsClose||window.isFocus))){window.isIE||window.noticeAudioIsClose||this.audio||(this.audio=document.createElement("audio"),this.audio.src="https://img.bosszhipin.com/audio/message.mp3",this.audio.preload="auto",this.audio.load());var s=this
;this.Notification=window.Notification||window.mozNotification||window.webkitNotification,this.Notification&&("granted"==this.Notification.permission?s.handler(e,t,i):this.Notification.requestPermission(function(r){if("granted"!==r)return!1;s.handler(e,t,i)}))}},handler:function(e,t,i){var s=this,r=this.formatMessage(i);if(r){window.noticeAudioIsClose||this.audio.play();var n=new this.Notification(e,{body:this.formatText(r),icon:t,tag:"replace",renotify:!0});this.data[i.mid]=n,this.dataArray.push(i.mid),n.onclick=function(){if(i.isSelf)var e=i.to.uid;else var e=i.from.uid;Chat.toggleUser({uid:e}),n.close(),window.focus()},n.onerror=function(){},n.onshow=function(){setTimeout(function(){n.close()},5e3)},n.onclose=function(){delete s.data[i.mid];for(var e=0;e<s.dataArray.length;e++)s.dataArray[e]==i.mid&&s.dataArray.splice(e,1)}}},messageTypes:{text:{types:[1,1,1],result:function(e){return e.isSelf?null:e.body.text}},voice:{types:[1,2],result:function(e){return e.isSelf?null:"[收到语音消息，请登录APP端查收]"}},image:{types:[1,3],result:function(e){return e.isSelf?null:"[收到图片消息，请登录APP端查收]"}},redEnvelope:{types:[3,10],result:function(e){if(!e.isSelf)return"[收到红包消息，请登录APP端查收]"}},getSystemText:{types:[3,1,1],result:function(e){return e.isSelf?null:e.body.text}},getSystemMessage:{types:[3,1],result:function(e){return e.body.text}},interview:{types:[1,7,4],result:function(e){return null}},dialogMessage:{types:[1,7,0],result:function(e){return e.body.dialog.title&&e.body.dialog.title.indexOf("面试邀请")>-1?null:e.isSelf?null:e.body.dialog.text}},dialogWeixin:{types:[1,7,1],result:function(e){return e.isSelf?null:e.body.dialog.text}},dialogResume:{types:[1,7,2],result:function(e){return e.isSelf?null:e.body.dialog.text}},agreeInterview:{types:[3,4,47],result:function(e){return e.from.name+"接受了您的面试邀请。"}}},formatMessage:function(e){var t=this;for(var i in this.messageTypes){var s=this.messageTypes[i],r=s.types;if(r[0]==e.type&&r[1]==e.body.type)if(1==r[0]&&7==r[1]){if(r[2]==e.body.dialog.type)return s.result.call(t,e)}else if(3==r[0]&&4==r[1]){if(r[2]==e.body.action.aid)return s.result.call(t,e)}else{if(3!=r.length)return s.result.call(t,e);if(r[2]==e.body.templateId)return s.result.call(t,e)}}return null},formatText:function(e){return e=e.replace(/\[[a-zA-Z\u4e00-\u9fa5]{1,3}\]/g,"[表情]"),e.match(/./g).length>18&&(e=e.substring(0,18)+"..."),e}};var Chat={init:function(){if(Chat.isSuportCalc=!0,"undefined"==typeof Modernizr||Modernizr.prefixedCSSValue("height","calc(0vh)")||(Chat.isSuportCalc=!1),Chat.usersCon=$(".boss-list"),$(".nav-figure").length&&$(".standard").length&&(Chat.usersTempData=[],Chat.usersData={},Chat.myselfData={uid:_PAGE.uid,name:_PAGE.name,face:_PAGE.face},Publisher.init(),Chat.curUserData={},Chat.messageStatusData={},Chat.messageStatusDataTemp={},Chat.receiveMaxId=-1,Chat.mids={},Chat.unreadCountBox=$(".nav-chat-num"),Chat.unreadMessageCount=0,Chat.unReadMessages={},Chat.websocketConnected=!1,Chat.outputData={30:{count:0},31:{count:0},35:{count:0}},Chat.userList.init(),Chat.chatList=$(".chat-list"),Chat.chatListCon=Chat.chatList.find("ul"),Chat.chatList.length&&(Chat.curUserData.messageMinId=0,Chat.curUserData.uid=Chat.chatList.attr("data-uid"),Chat.curUserData.encryptUid=Chat.chatList.attr("data-eid"),Chat.curUserData.newMsgCount=0,Chat.curUserData.historyPage=1,Chat.curUserData.canLoadingData=!1,Chat.curUserData.historyLastItem=null,Chat.chatList.on("click","img",function(){var e=$(this).attr("data-large"),t=$(this).attr("large-x"),i=$(this).attr("large-y");e&&$.confirm({content:'<img src="'+e+'" width="'+t+'" height="'+i+'" />',title:!1,closeIcon:!0,confirmButton:!1,cancelButton:!1,boxWidth:t+"",columnClass:"pop-imgview",onOpen:function(){this.$body.css({width:t+"px",height:i+"px"})},confirm:function(){},error:function(e){}})})),Chat.isSuportCalc||(Chat.chatList.css("height",$(window).height()-334+"px"),$(".chat-sider .detail-content").css("height",$(window).height()-509+"px"))),window.localStorage)for(var e=0;e<localStorage.length;e++)localStorage.key(e).indexOf("/chatws:ws-")>-1&&localStorage.removeItem(localStorage.key(e))},userList:{init:function(){this.page=0,this.elList=Chat.usersCon.find("ul"),this.RenderPage=0,this.listMore=!1,this.tipsContainer=Chat.usersCon.find(".data-tips"),this.elMore=Chat.usersCon.find(".loadmore"),this.isLoading=!1,this.getList(this.page);var e=this;this.elList.on("click",".btn-continue",function(){var e=$(this),t=e.closest("li");t.removeClass("read"),t.find(".icon-new").remove()}),this.elMore.on("click",function(){e.page++,$(this).hasClass("disabled")||e.updateUserList(e.page)})},getList:function(e){var t=this,e=e;t.isLoading=!0,0==e&&t.elMore.hide(),$.ajax({type:"GET",url:"/gchat/userList.json",dataType:"JSON",data:"page="+e,success:function(i){if(i.rescode&&i.data.length){var s,r=i.data;for(s=0;s<r.length;s++)Chat.usersData[r[s].uid]||(Chat.usersData[r[s].uid]=r[s],Chat.usersData[r[s].uid].fromSource="list",Chat.usersData.newMsgCount||(Chat.usersData[r[s].uid].newMsgCount=0));0==e&&(t.updateUserList(0),r.length>14&&t.elMore.show()),t.tipsContainer.html("").hide(),Chat.chatList.length&&(Chat.chatList.on("scroll",function(){var e=$(this);Chat.curUserData&&(Chat.timerHistory&&clearTimeout(Chat.timerHistory),Chat.timerHistory=setTimeout(function(){e.scrollTop()<20&&Chat.curUserData.canLoadingData&&(Chat.curUserData.historyPage++,Chat.curUserData.historyLastItem=Chat.chatListCon.find("li").eq(0),Chat.getHistoryMessage({uid:Chat.curUserData.uid,name:Chat.curUserData.name,avatar:Chat.curUserData.avatar},Chat.curUserData.messageMinId,Chat.curUserData.historyPage))},200))}),Chat.getHistoryMessage({uid:Chat.curUserData.uid},Chat.curUserData.messageMinId,1))}else 0==e&&t.tipsContainer.html('<div class="data-blank"><i class="tip-nodata"></i><b>没有相关数据</b></div>').show();t.isLoading=!1,Chat.protobufMessage=new ProtobufMessage(this),ChatWebsocket.init()},error:function(e){t.isLoading=!1}})},renderUserList:function(e,t){var i,s,r=this,n=e,t=t,o="",a=0,h=[];for(i=0;i<n.length;i++)i>0&&i%15==0&&a++,void 0===h[a]&&(h[a]=[]),h[a].push(n[i]);if(h[t])for(s=0;s<h[t].length;s++)o+=r.renderUser(h[t][s]);!h[t]||h[t].length<15?r.elMore.addClass("disabled").text("没有更多了").show():r.elMore.removeClass("disabled").text("点击加载更多").show(),t>0?Chat.userList.elList.append(o):Chat.userList.elList.html(o)},renderUser:function(e){var t="",i="",s="",r="",n="";return e.uid>1e3?(s="<em>·</em>"+e.companyName+(e.experienceName?"<em>·</em>"+filterXss(e.experienceName):""),t='<div class="op"><span class="time">'+e.lastTime+'</span><a class="btn btn-continue" href="/gchat/im.html?bossId='+e.encryptBossId+'" target="_blank" ka="go_chat_done_'+e.jobId+'">继续沟通</a></div>',i='<span class="gray">'+(e.jobName?"招"+filterXss(e.jobName)+'<em class="vline"></em>':"")+(e.locationName?e.locationName+'<em class="vline"></em>':"")+(e.salary?e.salary:"")+"</span>",e.newMsgCount?n='<i class="icon-new"></i>':r=' class="read"'):(t='<div class="op"><span class="time">'+e.lastTime+'</span><a class="btn btn-view" href="/gchat/im.html?bossId='+e.encryptBossId+'" target="_blank">查看消息</a></div>',e.newMsgCount?(r=' class="notice"',n='<i class="icon-new"></i>'):r=' class="notice read"'),"<li"+r+' data-uid="'+e.uid+'"><div class="figure"><img src="'+e.tinyUrl+'" /></div>'+t+'<div class="text"><h3 class="name">'+e.name+s+i+'</h3><p class="gray">'+n+(e.lastMsg?"“"+filterXss(e.lastMsg)+"”":"")+"</p></div></li>"},changeUserList:function(){var e=Chat.usersData,t=[],i=[];for(var s in e)e[s]&&(e[s].uid<1e3&&""!=e[s].lastMsg?i.push(e[s]):e[s].uid>1e3&&t.push(e[s]));return t.sort(function(e,t){return t.lastTS-e.lastTS}),i.concat(t)},updateUserList:function(e,t){var i=this;if(Chat.userList.elList.length){var s=i.changeUserList(),e=e;if(t=t)for(var r=0;r<=t;r++)i.renderUserList(s,r);else i.renderUserList(s,e)}}},showMessage:function(message){if(message){var base=Chat.showMessageBase(message);if(!message.offline){message.from.uid==Chat.myselfData.uid&&(message.isSelf=!0);var messageHtml="";switch(message.body.type){case 1:messageHtml=3==message.body.templateId||6==message.body.templateId?this.showSystemMessage(message):this.showTextMessage(message);break;case 2:message.isSelf||(message.body.text="收到一条不支持的消息，请在 App 查看",messageHtml=this.showSystemMessage(message));break;case 3:1==message.body.templateId&&(message.body.image&&(message.body.text='<img src="'+message.body.image.tinyImage.url+'" width="'+message.body.image.tinyImage.width+'" height="'+message.body.image.tinyImage.height+'" data-large="'+message.body.image.originImage.url+'" large-x="'+message.body.image.originImage.width+'" large-y="'+message.body.image.originImage.height+'"'),messageHtml=this.showTextMessage(message));break;case 4:if(20==message.body.action.aid){var extend=eval("("+message.body.action.extend+")");Chat.setDialogMessageDomStatus(extend.msg_id)}else if(27==message.body.action.aid)message.body.text="请求交换联系方式已发送",messageHtml=this.showSystemMessage(message);else if(32==message.body.action.aid)message.body.text="请求交换微信已发送",messageHtml=this.showSystemMessage(message);else if(37==message.body.action.aid){var email=_PAGE.email;if(message.body.action.extend){var extend=eval("("+message.body.action.extend+")");email=extend.resumeEmail}message.body.text="简历请求已发送。如果牛人同意，TA的简历将发送到{"+email+"}!",messageHtml=this.showSystemMessage(message)}else if(40==message.body.action.aid){var email=_PAGE.email;if(message.body.action.extend){var extend=eval("("+message.body.action.extend+")");email=extend.resumeEmail}message.body.text="简历附件已发送",messageHtml=this.showSystemMessage(message)}break;case 7:message.isSelf?0==message.body.dialog.type||4==message.body.dialog.type&&(base.userData.isCloseInterview=!0):(message.body.text="收到一条不支持的消息，请在 App 查看",messageHtml=this.showSystemMessage(message));break;case 12:2==message.body.hyperLink.hyperLinkType&&(message.body.hyperLink.text.indexOf("面试提醒")>-1||message.body.hyperLink.text.indexOf("面试邀请")>-1)&&message.to.uid==Chat.myselfData.uid?(message.body.text=message.body.hyperLink.text,messageHtml=this.showSystemMessage(message)):3==message.body.hyperLink.hyperLinkType&&message.to.uid==Chat.myselfData.uid?(message.body.text=message.body.hyperLink.text,messageHtml=this.showSystemMessage(message)):1==message.body.hyperLink.hyperLinkType&&message.to.uid==Chat.myselfData.uid&&(message.body.text=message.body.hyperLink.text,messageHtml=this.showSystemMessage(message));break;case 99:messageHtml=this.showSystemMessage(message);break;default:message.body.text="收到一条不支持的消息，请在 App 查看",messageHtml=this.showSystemMessage(message)}99==message.body.type&&message.from.uid==Chat.curUserData.uid?$(messageHtml).appendTo(Chat.chatListCon):(message.from.uid==Chat.myselfData.uid&&message.to.uid==Chat.curUserData.uid||message.to.uid==Chat.myselfData.uid&&message.from.uid==Chat.curUserData.uid)&&(messageHtml&&message.from.uid==Chat.curUserData.uid||message.from.uid==Chat.myselfData.uid)&&(Chat.showTimeLine(message),Chat.chatListCon.find("#temp-"+message.mid).length||(Chat.curUserData.historyLastItem&&"history"==message.typeSource?$(messageHtml).prependTo(Chat.chatListCon):($(messageHtml).appendTo(Chat.chatListCon),Chat.scrollToBottom())))}}},showMessageOther:function(e){if(e){var t=null;switch(e.body.type){case 1:1==e.body.templateId?Chat.showMessage(e):3==e.body.templateId||7==e.body.templateId||6==e.body.templateId?Chat.showMessage(e):5==e.body.templateId&&e.to.uid==Chat.myselfData.uid&&(e.body.text=e.body.text.replace(/\<\/?[a-zA-Z]+\>/g,"").replace(/&lt;\/?phone&gt;/g,"").replace(/&lt;\/?copy&gt;/g,""),Chat.showMessageBase(e),t=Chat.showSystemMessage(e));break;case 4:if(30==e.body.action.aid)Chat.outputData[e.body.action.aid]=JSON.parse(e.body.action.extend);else if(31==e.body.action.aid)Chat.outputData[e.body.action.aid]=JSON.parse(e.body.action.extend);else if(35==e.body.action.aid)Chat.outputData[e.body.action.aid]=JSON.parse(e.body.action.extend);else if(47==e.body.action.aid);else if(48==e.body.action.aid){var i=Chat.usersData[e.from.uid];i&&(i.isCloseInterview=!1)}else e.body.action.aid;break;case 8:break;case 10:Chat.showMessageBase(e),e.isSelf?e.body.text="发出一个红包，请登录APP查看":e.body.text="收到红包消息，请登录APP端查收",t=Chat.showSystemMessage(e)}99==e.body.type&&e.from.uid==Chat.curUserData.uid?$(t).appendTo(Chat.chatListCon):(e.from.uid==Chat.myselfData.uid&&e.to.uid==Chat.curUserData.uid||e.to.uid==Chat.myselfData.uid&&e.from.uid==Chat.curUserData.uid)&&(t&&e.from.uid==Chat.curUserData.uid||e.from.uid==Chat.myselfData.uid)&&(Chat.showTimeLine(e),Chat.curUserData.historyLastItem&&"history"==e.typeSource?$(t).prependTo(Chat.chatListCon):($(t).appendTo(Chat.chatListCon),Chat.scrollToBottom()))}},showTextMessage:function(e){var t="",i="",s="",r=(e.time,this.messageConverToHtml(filterXss(e.body.text))),n="temp-"+e.tempID;if("newSubmit"==e.typeSource&&(r=this.messageConverToHtml(filterXss(e.body.text))),e.from.uid==Chat.myselfData.uid){if("history"==e.typeSource)switch(i='<i class="status"></i>',e.status){case 0:t="status-delivery";break;case 1:t="status-delivery";break;case 2:t="status-read";break;default:t="",i=""}else"newSubmit"==e.typeSource?(s='id="'+n+'"',i='<i class="status"></i>'):e.from.uid==Chat.myselfData.uid&&(t="status-delivery",i='<i class="status"></i>');var o=Chat.messageStatusData[e.to.uid];return o||(o=Chat.messageStatusData[e.to.uid]={}),e.mid?(s='id="temp-'+e.mid+'"',o[e.mid]={}):(Chat.messageStatusDataTemp[e.tempID]=e.to.uid,o[e.tempID]={tempID:e.tempID}),"<li "+s+' class="item-myself '+t+'"><div class="figure"></div><div class="text">'+i+r+"</div></li>"}return"<li "+(e.mid?'id="temp-'+e.mid+'"':"")+' class="item-friend"><div class="figure"><img src="'+e.from.avatar+'" alt="" /></div><div class="text">'+r+"</div></li>"},showSystemMessage:function(e){if(e.body.text){var t='<li class="item-system" id="temp-'+e.mid+'"><div class="text">'+e.body.text+"</div></li>";return 12==e.body.type&&e.body.hyperLink&&1==e.body.hyperLink.hyperLinkType&&(t='<li class="item-system"><div class="text">收到附件简历，请登录邮箱{'+_PAGE.email+"}查看</div></li>"),t}},showDialogMessage:function(e){var t,i="",s="";switch(e.body.dialog.type){case 0:i="item-phone";break;case 1:i="item-weixin";break;case 2:i="item-resume"}return e.body.dialog.operated&&(s="disabled"),t=$('<li class="item-friend '+i+'"><div class="figure"><img src="'+e.from.avatar+'" alt="" /></div><div class="text"><p>'+this.messageConverToHtml(e.body.dialog.text)+'</p><div class="btns"><button type="button" class="btn btn-agree '+s+'">同意</button><button type="button" class="btn btn-danger btn-refuse '+s+'">拒绝</button></div></div></li>'),t.on("click",".btn",function(s){if($(this).hasClass("disabled"))return!1;t.find(".btn").addClass("disabled"),"item-phone"==i&&($(this).hasClass("btn-agree")?Chat.exchangePhone(1,e):Chat.exchangePhone(0,e)),"item-weixin"==i&&($(this).hasClass("btn-agree")?Chat.exchangeWeixin(1,e):Chat.exchangeWeixin(0,e)),"item-resume"==i&&($(this).hasClass("btn-agree")?Chat.exchangeResume(1,e):Chat.exchangeResume(0,e))}),t},setDialogMessageDomStatus:function(e,t){e&&Chat.chatListCon.find("#temp-"+e).find(".btn").addClass("disabled").unbind("click")},messageConverToHtml:function(e){var t=Emotion.textCodeToImg(e);return t=/^&lt;img src="/.test(t)?t.replace("&lt;","<").replace("&gt;",">"):t.replace(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|\&|-)+)/g,"<a href='$1$2' target='_blank'>$1$2</a>"),e?t.replace(/\n/g,"<br/>"):""},setTextMessageDomStatus:function(e,t,i,s){if(Chat.curUserData.uid==e){var r,n=Chat.messageStatusData[e];if(n)if(t&&i&&(n[t]=n[i],r=Chat.chatListCon.find("#temp-"+n[i].tempID),delete n[i],delete Chat.messageStatusDataTemp[i]),t&&!i&&(r=Chat.chatListCon.find("#temp-"+t)),"read"==s)Chat.chatListCon.find(".status-delivery").removeClass("status-delivery").addClass("status-read");else if(s){var o=n[t?t:i];if(!o)return;r.attr("class",r.attr("class").replace(/status\-/g,"")).addClass("status-"+s),t&&r.attr("id","temp-"+t),"error"==s&&(delete n[o.tempID],delete n[t])}}},sendReadMessage:function(e){e.mid&&e.uid!=Chat.myselfData.uid&&ChatWebsocket.sendReadMessage({uid:e.uid,mid:e.mid,callback:function(t){e.curUserData.maxMessageId=null}})},getOutputData:function(){return Chat.outputData},sendTextMessage:function(e){var t=e.noWebsocket||!1;Chat.showMessage(e);var i=Chat.protobufMessage.createMessage.text(e);ChatWebsocket.send(i),t&&$.ajax({url:"/chat/sendmsg.json",type:"POST",data:{to:e.to.uid,text:e.body.text},dataType:"JSON",cache:!1,timeout:3e4,success:function(t){1==t.result?(Chat.mids[t.mid]="Text",Chat.setTextMessageDomStatus(e.to.uid,t.mid,e.tempID,"delivery")):Chat.setTextMessageDomStatus(e.to.uid,t.mid,e.tempID,"error")},error:function(t){Chat.setTextMessageDomStatus(e.to.uid,t.mid,e.tempID,"error")}})},showTimeLine:function(e){var t,i=new Date(e.time),s=Chat.curUserData.lastMessageTime,r=new Date,n=new Date(e.time);r=new Date(r.getFullYear(),r.getMonth(),r.getDate()),t=r-n>0?"MM-dd hh:mm":"Z hh:mm",s&&i-s>3e5&&$('<li class="item-time"><span class="time">'+this.dateFormat(i,t)+"</span></li>").appendTo(Chat.chatListCon),Chat.curUserData.lastMessageTime=e.time},dateFormat:function(e,t){var i={Z:"","M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"H+":e.getHours()>12?e.getHours()-12:e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in i)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[s]:("00"+i[s]).substr((""+i[s]).length)));return t},scrollToBottom:function(){Chat.chatList.scrollTop(Chat.chatListCon.outerHeight()+119)},toggleUser:function(e){Chat.curUserData.encryptUid&&(Chat.curUserData.encryptUid,e.uid)},getHistoryMessage:function(info,maxId,page){$.ajax({url:"/gchat/historymsg.json",type:"GET",data:{bossId:info.uid,maxMsgId:maxId,c:20,page:page},dataType:"JSON",timeout:2e4,success:function(result){var result=result;if("string"==typeof result&&(result=eval("("+result+")")),1==result.type&&result.messages){var len=result.messages.length,i,message;if(len>0){if(Chat.curUserData.historyLastItem)for(i=len-1;i>=0;i--)message=result.messages[i],message.mSource="server",message.typeSource="history",ChatWebsocket.receiveTextMessage(message);else{for(i=0;i<len;i++)message=result.messages[i],message.mSource="server",message.typeSource="history",ChatWebsocket.receiveTextMessage(message),message.from.uid!=Chat.curUserData.uid||4==message.type||4==message.body.type||message.uncount||(Chat.curUserData.maxMessageId=result.messages[i].mid);Chat.curUserData.maxMessageId&&(Chat.websocketConnected?Chat.sendReadMessage({userData:Chat.curUserData,uid:Chat.curUserData.uid,mid:Chat.curUserData.maxMessageId}):(Chat.interConnect&&clearInterval(Chat.interConnect),Chat.interConnect=setInterval(function(){Chat.websocketConnected&&(Chat.sendReadMessage({userData:Chat.curUserData,uid:Chat.curUserData.uid,mid:Chat.curUserData.maxMessageId}),clearInterval(Chat.interConnect))},1e3)))}Chat.curUserData.messageMinId=result.messages[0].mid,Chat.curUserData.canLoadingData=!0}if(1==page&&(Chat.showChatListTimeer&&clearTimeout(Chat.showChatListTimeer),Chat.showChatListTimeer=setTimeout(function(){Chat.chatList.css("visibility","visible")},100),!isEmptyObject(Chat.curUserData)&&Chat.curUserData.newMsgCount&&Chat.clearMessageCount(Chat.curUserData,Chat.curUserData.newMsgCount)),Chat.curUserData.historyLastItem)try{Chat.chatList.scrollTop(Chat.curUserData.historyLastItem.offset().top-Chat.chatList.height()-100)}catch(e){}}else Chat.curUserData.canLoadingData=!1},error:function(e){Chat.curUserData.canLoadingData=!0}})},getUserInfo:function(uid,callback){$.ajax({url:"/gchat/bossInfo.json",data:{uid:uid},dataType:"JSON",timeout:5e3,success:function(e){"string"==typeof e&&(e=eval("("+e+")")),callback(e)},error:function(e){callback({status:0,msg:"系统错误"})}})},addUser:function(e,t,i){var s={};if(e&&Chat.usersData[e])s=Chat.usersData[e];else if(i){s={tinyUrl:i.from.avatar,fromSource:i.mSource,isTop:0,lastTime:i.time,name:i.from.name,sex:0,newMsgCount:0,uid:i.from.uid,encryptBossId:t};var r="",n=s.lastTime,o=new Date,a=new Date(o.getFullYear(),o.getMonth(),o.getDate()),h=a-n;if(r=o.getFullYear()!=new Date(n).getFullYear()&&o.getFullYear()-new Date(n).getFullYear()>1?o.getFullYear()-new Date(n).getFullYear()+"年前":h>864e5?Chat.dateFormat(new Date(n),"MM月dd日"):h>0?"昨天":Chat.dateFormat(new Date(n),"hh:mm"),Chat.usersData[e]=s,Chat.usersData[e].lastTime=r,i.offline)return;Chat.getUserInfo(e,function(t){if(t.rescode){var s=t.data;Chat.usersData[e]=s,s.uid!=Chat.myselfData.uid&&Chat.showMessageBase(i)}})}if(s.encryptBossId&&s.uid!=Chat.myselfData.uid){var l=Chat.userList.renderUser(s),f=Chat.userList.elList.find('li[data-uid="'+s.uid+'"]');f.length?f.remove():Chat.userList.elList.find("li:last").remove(),$(l).prependTo(Chat.userList.elList)}},showMessageBase:function(e){var t;e.from.uid==Chat.myselfData.uid&&(e.isSelf=!0);var i=0;if(!Chat.curUserData.uid||e.offline||e.received||Chat.curUserData.uid!=e.from.uid&&Chat.curUserData.uid!=e.to.uid){if(e.from.uid==Chat.myselfData.uid)var s=e.to;else if(e.to.uid==Chat.myselfData.uid)var s=e.from;isEmptyObject(Chat.curUserData)||!Chat.usersData||Chat.usersData[s.uid]||Chat.addUser(s.uid,null,e);var r=Chat.usersData?Chat.usersData[s.uid]:Chat.curUserData;if(e.isSelf||(i=1),t=s.uid,!e.offline&&!e.received&&Chat.userList.elList){var n=Chat.userList.elList.find('li[data-uid="'+t+'"]').parent();if(n.length)n.prependTo(n.closest("ul"));else{if(!Chat.usersData[t])return void Chat.addUser(s.uid,null,e);Chat.addUser(t,Chat.usersData[t].encryptBossId)}}}else{var r=Chat.curUserData;e.isSelf||99==e.body.type||"history"==e.typeSource||4==e.type||4==e.body.type||Chat.sendReadMessage({userData:r,uid:e.from.uid,mid:e.mid}),t=r.uid}i&&r&&"history"!=e.typeSource&&!e.received&&4!=e.type&&4!=e.body.type&&!e.uncount&&(!e.offline||!r.maxMessageId||e.offline&&r.maxMessageId&&e.mid>r.maxMessageId)&&(r.newMsgCount?r.newMsgCount++:r.newMsgCount=1,r.mids||(r.mids=[]),7!=e.body.type&&13!=e.body.type||(r.lastMsg="收到一条不支持的消息，请在 App 查看"),r.mids.push(e.mid),Chat.showMessageCountInfo(r),Chat.setUnReadMessageCount(1)),e.isSelf||!r||r.maxMessageId&&!(r.maxMessageId<e.mid)||4==e.body.type||4==e.type||e.uncount||(r.maxMessageId=e.mid),e.isSelf||"history"==e.typeSource||4==e.type||4==e.body.type||8==e.body.type||(Chat.unReadMessages[e.from.uid]||(Chat.unReadMessages[e.from.uid]={},Chat.unReadMessages[e.from.uid]=[]),$.inArray(e.mid,Chat.unReadMessages[e.from.uid])==-1&&Chat.unReadMessages[e.from.uid].push(e.mid));var o=filterXss(e.body.text)||filterXss(e.pushText);if(o&&!e.offline&&"history"!=e.typeSource&&4!=e.type&&4!=e.body.type&&!e.uncount){new Date(e.time);Chat.usersCon.length&&(Chat.usersData[r.uid]&&e.time>Chat.usersData[r.uid].lastTS&&(Chat.usersData[r.uid].lastTime=Chat.getLastTime(e.time),Chat.usersData[r.uid].lastTS=e.time),7!=e.body.type&&2!=e.body.type||e.isSelf?(!e.isSelf||7!=e.body.type&&12!=e.body.type)&&(e.isSelf&&3==e.body.type?Chat.usersData[r.uid].lastMsg="图片已发送":Chat.usersData[r.uid].lastMsg=o):Chat.usersData[r.uid].lastMsg="收到一条不支持的消息，请在 App 查看",Chat.userList.updateUserList(0,Chat.userList.page))}return{userData:r,setUnReadMessageCount:Chat.setUnReadMessageCount}},setUnReadMessageCount:function(e){Chat.unreadMessageCount+=e,Chat.unreadMessageCount>99?Chat.unreadCountBox.html('<i class="dot-plenty"></i>'):Chat.unreadCountBox.html(Chat.unreadMessageCount),Chat.unreadMessageCount&&Chat.unreadMessageCount>0?(Chat.unreadCountBox.css("display","inline-block"),Chat.unreadCountBox.parent().attr("ka","nav_msg_red")):(Chat.unreadCountBox.hide(),Chat.unreadCountBox.parent().attr("ka","nav_msg"))},onChangeReadMessageCount:function(e){localStorageInstance("msgcount",e)},checkReadMessageCount:function(e){e>99?Chat.unreadCountBox.html('<i class="dot-plenty"></i>'):Chat.unreadCountBox.html(e),e&&e>0?Chat.unreadCountBox.css("display","inline-block"):Chat.unreadCountBox.hide()},clearMessageCount:function(e,t){e.newMsgCount-t<0&&(t=e.newMsgCount),Chat.setUnReadMessageCount(t*-1),e.newMsgCount-=t,Chat.showMessageCountInfo(e)},showMessageCountInfo:function(e){if(Chat.usersData){var t=e.newMsgCount,i=filterXss(e.lastMsg),s=Chat.userList.elList.find('li[data-uid="'+e.uid+'"]');t?(s.removeClass("read"),s.find("p.gray").html('<i class="icon-new"></i>'+(i?i:"")),s.find(".icon-new").show()):(s.addClass("read"),s.find(".icon-new").hide())}},addUserCount:function(e){Chat.usersData[e.from.uid]&&Chat.userList.elList.find('a[data-uid="'+e.from.uid+'"]').find(".figure").prepend('<span class="notice-badge"></span>')},addMessageId:function(e,t){(!Chat.curUserData||Chat.curUserData&&Chat.curUserData.userId!=e)&&(Chat.usersData[e].mids||(Chat.usersData[e].mids=[]),t>Chat.usersData[e].maxMessageId&&(Chat.usersData[e].mids.push(t),Chat.usersData[e].maxMessageId=t))},setMessageMinId:function(e,t){Chat.usersData[e].messageMinId||(Chat.usersData[e].messageMinId=t)},getLastTime:function(e){this.lastMessageTime=e;var t=new Date,i=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s=i-e;return t.getFullYear()!=new Date(e).getFullYear()&&t.getFullYear()-new Date(e).getFullYear()>1?t.getFullYear()-new Date(e).getFullYear()+"年前":s>864e5?Chat.dateFormat(new Date(e),"MM月dd日"):s>0?"昨天":Chat.dateFormat(new Date(e),"hh:mm")},setSyncTotalCount:function(e,t,i){if(Chat.unreadMessages&&Chat.unreadMessages[e]){var s,r,n=Chat.unreadMessages[e];if(!n)return;if(i)for(s=0;s<n.length;s++)n[s]<i&&(r++,n.splice(0,s));Chat.reduceMessageCount(e,r)}},reduceMessageCount:function(e,t){var t=t;Chat.unreadMessages[e].length-t<0&&(t=Chat.unreadMessages[e].length),Chat.setUnReadMessageCount(t*-1),Chat.usersData&&Chat.usersData[e]&&(Chat.usersData[e].newMsgCount-=t)}},ChatWebsocket={init:function(){this.settings={cid:"",token:"",password:"",receiveUrl:"",receiveStepTime:5e3,onSendMessage:function(e){},onRecevieMessage:function(e){},onlineDebug:!!getQueryString("debug")};var e=cookie.get("wt")||cookie.get("t");e&&(ChatWebsocket.settings.password=e),this.uuid="ws-"+getUuid(16,16),this.client=new Paho.MQTT.Client(_PAGE.ws.server,_PAGE.ws.port,"/chatws",this.uuid),this.client.onConnectionLost=this.onConnectionLost,this.client.onMessageArrived=this.onMessageArrived,this.client.onMessageDelivered=this.onMessageDelivered,this.connection(),ChatWebsocket.checkConnectInter=setInterval(function(){cookie.get("wt")||cookie.get("t")||(clearInterval(ChatWebsocket.checkConnectInter),ChatWebsocket.disconnect())},2e3)},logCss:"font-weight:bold;color:#ff0000;",connection:function(){var e=cookie.get("wt")||cookie.get("t");e&&(ChatWebsocket.settings.password=e,this.client.connect({userName:_PAGE.token,password:ChatWebsocket.settings.password,timeout:60,keepAliveInterval:40,cleanSession:!0,onSuccess:this.onConnect,onFailure:this.onFailure,mqttVersion:3,useSSL:!!_PAGE.ws.useSSL}))},disconnect:function(){this.client.disconnect()},reConnection:function(){this.connection()},sendPresence:function(){var e=cookie.get("__a").split("."),t=Chat.protobufMessage.createMessage.presence({type:1,lastMessageId:Chat.receiveMaxId<0?0:Chat.receiveMaxId,clientInfo:{version:"",system:"",systemVersion:"",model:cookie.get("sid")||"",uniqid:e[1]+""+e[0]||"",network:_PAGE.clientIP||"",appid:9019,platform:"web",channel:"-1",ssid:"",bssid:"",longitude:0,latitude:0}});ChatWebsocket.settings.onlineDebug&&(console.log("%cpresence:",ChatWebsocket.logCss),console.log(t)),ChatWebsocket.send(t,2)},onConnect:function(e){ChatWebsocket.settings.onlineDebug&&console.log("%cconnect:",ChatWebsocket.logCss),ChatWebsocket.sendPresence(),Chat.websocketConnected=!0},onFailure:function(e,t,i){if(ChatWebsocket.settings.onlineDebug&&(console.log("%conFailure:",ChatWebsocket.logCss),console.log(e,t,i)),"object"==typeof e&&6==e.errorCode){var s=e.errorMessage.match(/^AMQJS0006E Bad Connack return code:(\d).+$/);s&&(3==parseInt(s[1],10)?setTimeout(function(){ChatWebsocket.reConnection()},2e3):(alert("登录信息失效"),window.location.reload()))}else setTimeout(function(){ChatWebsocket.reConnection()},2e3)},onConnectionLost:function(e){this.onlineDebug&&(console.log("%conConnectionLost(data):",ChatWebsocket.logCss),console.log(e)),8==e.errorCode&&ChatWebsocket.reConnection(),0!==e.errorCode&&(console.log("%conConnectionLost(message):",ChatWebsocket.logCss),console.log(e.errorMessage))},onMessageArrived:function(e){try{var t=e.payloadBytes,i=Chat.protobufMessage.decode(t);switch(i=ChatWebsocket.eachParseInt(i),ChatWebsocket.settings.onlineDebug&&(console.log("%conMessageArrived(data):",ChatWebsocket.logCss),console.log(e),console.log("%conMessageArrived(message):",ChatWebsocket.logCss),console.log(i)),i.type){case 1:ChatWebsocket.receiveMessage(i);break;case 5:ChatWebsocket.receiveSyncMessage(i);break;case 6:ChatWebsocket.receiveStatusMessage(i)}}catch(e){console.log("%conMessageArrived(try error):",ChatWebsocket.logCss),console.log(e)}},onMessageDelivered:function(e){var t=e.payloadBytes,i=Chat.protobufMessage.decode(t);switch(i=ChatWebsocket.eachParseInt(i),i.type){case 1:for(var e=i.messages,s=0;s<e.length;s++)Chat.setTextMessageDomStatus(Chat.curUserData.uid,e[s].mid,null,"delivery");break;case 6:for(var s=0;s<i.messageRead.length;s++){var r=Chat.usersData[i.messageRead[0].userId];r&&r.maxMessageId==i.messageRead[0].messageId&&(r.maxMessageId=null)}}ChatWebsocket.settings.onlineDebug&&(console.log("%conMessageDelivered(data):",ChatWebsocket.logCss),console.log(e),console.log("%conMessageDelivered(message):",ChatWebsocket.logCss),console.log(i))},send:function(e,t){ChatWebsocket.settings.onlineDebug&&(console.log("%csend:",ChatWebsocket.logCss),console.log(e)),this.client.isConnected()?this.client.send("chat",e.toArrayBuffer(),t?t:2,!0):1==e.type&&1==e.messages[0].type&&1==e.messages[0].body.type?(ChatWebsocket.reConnection(),Chat.setTextMessageDomStatus(Chat.curUserData.uid,e.messages[0].cmid,null,"error")):ChatWebsocket.reConnection()},eachParseInt:function(e){for(var t in e){var i=e[t];i&&"object"==typeof i&&("boolean"==typeof i.unsigned&&"number"==typeof i.high&&"number"==typeof i.low?(longVal=new dcodeIO.Long(i.low,i.high),e[t]=parseInt(longVal.toString(),10)):this.eachParseInt(i))}return e},sendReadMessage:function(e){var e=Chat.protobufMessage.createMessage.read(e);ChatWebsocket.send(e)},receiveTextMessage:function(e){e.from&&e.to&&(e.from.uid>1e3?3==e.type?Chat.showMessageOther(e):1!=e.type&&2!=e.type&&4!=e.type||e.from.uid!=Chat.myselfData.uid&&e.to.uid!=Chat.myselfData.uid||Chat.showMessage(e):3==e.type?(995==e.from.uid&&Chat.showMessage(e),998==e.from.uid&&Chat.showMessageOther(e)):1==e.type&&995==e.from.uid&&Chat.showMessage(e))},receiveMessage:function(data){for(var mids="",isOfflineMsg=!1,i=0;i<data.messages.length;i++){var message=data.messages[i];if(isOfflineMsg=!!message.offline,3==message.type&&4==message.body.type)if(2001==message.body.action.extend){var countData=eval("("+message.body.headTitle+")");Chat.usersCon.length||Chat.chatList.length||Chat.setUnReadMessageCount(countData.msgcount)}else if(0==message.body.action.aid)switch(parseInt(message.body.action.extend,10)){case 1011:window.location.href=INTERFACE_URLS.logoutUrl;break;case 1012:var cookieWt=cookie.get("wt"),cookieT=cookie.get("t");if(cookieT&&cookieWt&&cookieT!=cookieWt)return void(window.location.href=INTERFACE_URLS.logoutUrl);alert("您订购的网页聊天服务已到期，版请重新购买！"),window.location.reload();break;case 1013:alert("抱歉，您的BOSS账号刚被冻结。请前往App端申请解冻，解冻后可正常使用"),window.location.href=INTERFACE_URLS.logoutUrl}Chat.receiveMaxId<message.mid&&(Chat.receiveMaxId=message.mid);var isSelfMessage=!1;for(var mid in Chat.mids)mid!=Chat.receiveMaxId?mid<Chat.receiveMaxId&&delete Chat.mids[mid]:isSelfMessage=!0;if(isSelfMessage){var toUserData=Chat.usersData[message.to.uid];toUserData&&toUserData.setMessageMinId(message.to.uid,message.mid)}else if(message.mSource="server",ChatWebsocket.receiveTextMessage(message),Chat.usersData&&message.mid&&(message.from.uid>1e3||995==message.from.uid)&&4!=message.type&&4!=message.body.type&&!message.uncount){
var toUserData=Chat.usersData[message.from.uid];toUserData&&(Chat.addMessageId(message.from.uid,message.mid),Chat.setMessageMinId(message.from.uid,message.mid))}}},receiveStatusMessage:function(e){if(e.messageRead)for(var t=0;t<e.messageRead.length;t++)e.messageRead[t].sync?ChatWebsocket.synchReadMessage(e.messageRead[t].userId,e.messageRead[t].messageId):e.messageRead[t].userId==Chat.curUserData.uid?Chat.setTextMessageDomStatus(e.messageRead[t].userId,e.messageRead[t].messageId,null,"read"):Chat.usersData&&Chat.usersData[e.messageRead[t].userId].maxMessageId&&e.messageRead[t].messageId<=Chat.usersData[e.messageRead[t].userId].maxMessageId?ChatWebsocket.synchReadMessage(e.messageRead[t].userId,e.messageRead[t].messageId):Chat.curUserData.uid&&e.messageRead[t].userId==Chat.curUserData.uid&&ChatWebsocket.synchReadMessage(e.messageRead[t].userId,e.messageRead[t].messageId)},receiveSyncMessage:function(e){if(e.messageSync)for(var t=0;t<e.messageSync.length;t++){var i=e.messageSync[t],s=Chat.messageStatusDataTemp[i.clientMid];s&&(Chat.mids[i.serverMid]="Text")}},synchReadMessage:function(e,t){var i=Chat.usersData?Chat.usersData[e]:Chat.curUserData;if(i){i.mids||(i.mids=[]),i.mids.sort(function(e,t){return e>t});for(var s=0,r=0;r<i.mids.length&&i.mids[r]<=t;r++)s++;i.mids.splice(0,s),Chat.clearMessageCount(i,s)}}};